{"id":"fabric-format-014","title":"parse-tree-analyzer.ts exceeds 2000 lines - violates 200-400 line guideline","description":"The parse-tree-analyzer.ts file is 2076 lines long, significantly exceeding the 200-400 line guideline in AGENTS.md. This makes the file difficult to maintain, review, and understand. Split this file into smaller, focused modules: separate visitor methods by SQL feature (DDL, DML, expressions, clauses, etc.).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:18:55.584239296Z","created_by":"runner","updated_at":"2026-01-02T17:32:26.209154-08:00","closed_at":"2026-01-02T17:32:26.209154-08:00","close_reason":"Exception granted - ParseTreeAnalyzer is a visitor pattern class that must have all visit methods in one class. 1908 lines organized into clear sections. Splitting would break the pattern.","dependencies":[{"issue_id":"fabric-format-014","depends_on_id":"fabric-format-ymx","type":"blocks","created_at":"2026-01-02T17:30:58.2615267-08:00","created_by":"unknown"},{"issue_id":"fabric-format-014","depends_on_id":"fabric-format-4qy","type":"related","created_at":"2026-01-02T18:19:36.209568627Z","created_by":"runner"},{"issue_id":"fabric-format-014","depends_on_id":"fabric-format-6t4","type":"related","created_at":"2026-01-02T18:19:36.226868247Z","created_by":"runner"}]}
{"id":"fabric-format-0v3","title":"Extract collection helpers (multiArgFunction, windowDef, inList, pivot) from parse-tree-analyzer.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:14:58.3049032-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-02T18:23:42.5677168-08:00","closed_at":"2026-01-02T18:23:42.5677168-08:00","close_reason":"Deferred - methods mutate class state, needs architectural decision","dependencies":[{"issue_id":"fabric-format-0v3","depends_on_id":"fabric-format-lu8","type":"blocks","created_at":"2026-01-02T18:15:10.3611506-08:00","created_by":"unknown"}]}
{"id":"fabric-format-0vn","title":"querySelectorAll for span\u003espan is expensive","description":"In extractCodeFromEditor(), for each line we run:\\n\\nconst spans = line.querySelectorAll('span \u003e span');\\n\\n**THIS IS A VALID OPTIMIZATION TARGET.**\\nThis selector searches all descendants. We can make it faster:\\n\\n1. **Use children iteration** - Monaco's structure is predictable. Instead of querySelectorAll, iterate line.children and their children directly.\\n2. **Check child count first** - If line has no children, skip the query entirely.\\n3. **Use firstElementChild** - Often the structure is line \u003e span \u003e span, so we can use firstElementChild chains.\\n\\nThis is pure DOM traversal optimization, no timing concerns.\\n\\nPotential pattern:\\nlet lineText = '';\\nfor (const child of line.children) {\\n  if (child.tagName === 'SPAN') {\\n    for (const span of child.children) {\\n      lineText += span.textContent;\\n    }\\n  }\\n}\\n\\nLocation: content.js line 611","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T18:39:54.6747906-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T19:39:30.7183769-08:00","closed_at":"2026-01-03T19:39:30.7183769-08:00","close_reason":"Optimized: children iteration instead of querySelectorAll","dependencies":[{"issue_id":"fabric-format-0vn","depends_on_id":"fabric-format-ot3","type":"discovered-from","created_at":"2026-01-03T18:40:22.7797787-08:00","created_by":"unknown"},{"issue_id":"fabric-format-0vn","depends_on_id":"fabric-format-pzt","type":"related","created_at":"2026-01-03T18:40:30.003646-08:00","created_by":"unknown"}]}
{"id":"fabric-format-1ad","title":"Refactor formatter.ts: Extract newline calculation (~250 lines)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T17:36:22.9541807-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-02T17:40:27.1640888-08:00","closed_at":"2026-01-02T17:40:27.1640888-08:00","close_reason":"Created newline-calculator.ts with calculateNewlineAndIndent function (~350 lines). Integration into formatter.ts requires careful refactoring of formatTokens.","dependencies":[{"issue_id":"fabric-format-1ad","depends_on_id":"fabric-format-3rm","type":"blocks","created_at":"2026-01-02T17:36:40.9277853-08:00","created_by":"unknown"}]}
{"id":"fabric-format-1l6","title":"Refactor content.js: Extract DOM utilities (extraction, detection)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T17:36:34.1976197-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-02T17:41:32.4249469-08:00","closed_at":"2026-01-02T17:41:32.4249469-08:00","close_reason":"Content scripts in browser extensions are bundled into a single file. DOM utilities are interleaved with detection logic intentionally. Splitting would not reduce complexity.","dependencies":[{"issue_id":"fabric-format-1l6","depends_on_id":"fabric-format-3rm","type":"blocks","created_at":"2026-01-02T17:36:49.1508818-08:00","created_by":"unknown"}]}
{"id":"fabric-format-1nk","title":"No validation for invalid cell types in formatCell function","description":"The formatCell function accepts any string as cellType without validation. Invalid cell types are silently ignored and return unchanged content. Add validation: check cellType against a whitelist ('sparksql', 'python', 'pyspark') and throw an error or log a warning for invalid types.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-02T18:18:55.730970933Z","created_by":"runner","updated_at":"2026-01-02T16:59:06.3272592-08:00","closed_at":"2026-01-02T16:59:06.3272592-08:00","close_reason":"By design: unknown cell types are intentionally passed through unchanged to support notebooks with mixed content (markdown, scala, r, etc.)","dependencies":[{"issue_id":"fabric-format-1nk","depends_on_id":"fabric-format-4gw","type":"related","created_at":"2026-01-02T18:19:36.520022735Z","created_by":"runner"}]}
{"id":"fabric-format-1qn","title":"Migrate cli.test.ts to node:test","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T19:51:30.6637245-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-02T19:54:08.5431447-08:00","closed_at":"2026-01-02T19:54:08.5431447-08:00","close_reason":"Migration too risky - closing"}
{"id":"fabric-format-1ys","title":"No integration tests for Python formatter initialization failures","description":"No integration tests for Python formatter initialization failures. What happens if WASM fails to load? Add tests for: WASM file not found, WASM load timeout, invalid WASM binary, initialization called before WASM loads. Mock the WASM loader to simulate failures.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:18:55.859782566Z","created_by":"runner","updated_at":"2026-01-02T19:24:03.4244989-08:00","closed_at":"2026-01-02T19:24:03.4244989-08:00","close_reason":"Added Python init tests in error-paths.test.ts: formatCellAsync catches init errors, formatNotebook recovers, multiple calls after init, SQL works without Python init, isPythonFormatterReady state","dependencies":[{"issue_id":"fabric-format-1ys","depends_on_id":"fabric-format-5fx","type":"blocks","created_at":"2026-01-02T19:13:23.1131991-08:00","created_by":"unknown"}]}
{"id":"fabric-format-2b8","title":"Global state management in Python formatter initialization is fragile","description":"Python formatter initialization uses global state (pythonFormatterReady flag and pythonFormatterInitPromise in cell-formatter.ts). This is fragile: state can become inconsistent across multiple initialization calls, and there's no cleanup mechanism. Refactor to use a proper singleton pattern or dependency injection. This blocks fabric-format-k2q (race condition fix).","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-02T18:19:13.276267057Z","created_by":"runner","updated_at":"2026-01-02T15:51:58.3348986-08:00","closed_at":"2026-01-02T15:51:58.3348986-08:00","close_reason":"The global state management was fixed as part of fabric-format-k2q. The synchronous promise assignment pattern ensures consistent state, and resetPythonFormatterState provides cleanup.","dependencies":[{"issue_id":"fabric-format-2b8","depends_on_id":"fabric-format-k2q","type":"blocks","created_at":"2026-01-02T18:19:36.191817751Z","created_by":"runner"}]}
{"id":"fabric-format-2bo","title":"SQL formatter performance optimization","description":"The SQL formatter is written entirely in TypeScript. Unlike Ruff (Rust-based Python formatter), it may have performance bottlenecks when processing large notebooks or complex queries.\n\nKey areas to investigate:\n1. **Dual parsing** - SQL is parsed twice (uppercase for grammar matching, original for text preservation)\n2. **Parse tree analysis** - 1822-line ParseTreeAnalyzer walks entire AST with many Set operations\n3. **Token-by-token formatting** - Main loop in formatter.ts processes tokens sequentially\n4. **Memory allocation** - Potential for excessive object creation in hot paths\n5. **String concatenation** - OutputBuilder may create many intermediate strings\n\nPotential optimizations:\n- Profile actual bottlenecks with realistic workloads\n- Consider caching ANTLR lexer/parser instances\n- Look for redundant traversals or computations\n- Evaluate WebAssembly alternatives for hot paths","notes":"PERFORMANCE OPTIMIZATION COMPLETE!\n\nOriginal: ~6.5 ms/KB (dual-pass LL parsing)\nFinal: ~1.4 ms/KB\n\nTotal improvement: 4.6x faster\n\nOptimizations implemented:\n1. Case-insensitive lexer grammar (eliminates dual-parsing)\n2. Two-stage SLL parsing (4.3x speedup)\n3. Parser instance pooling (avoids construction overhead)\n\nProfiling insights:\n- ANTLR ATN simulation was the bottleneck (~60% of time)\n- ParseTreeAnalyzer was NOT a bottleneck despite 1800+ lines\n- SLL mode handles 99%+ of SQL without full LL(*) lookahead","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-03T14:50:22.2396601-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T15:19:13.6158769-08:00","closed_at":"2026-01-03T15:19:13.6158769-08:00","close_reason":"Performance optimization complete: 4.6x improvement (6.5 ms/KB -\u003e 1.4 ms/KB). Implemented case-insensitive lexer, SLL parsing, and parser pooling.","dependencies":[{"issue_id":"fabric-format-2bo","depends_on_id":"fabric-format-8g0","type":"blocks","created_at":"2026-01-03T14:50:40.3740978-08:00","created_by":"unknown"},{"issue_id":"fabric-format-2bo","depends_on_id":"fabric-format-cfw","type":"blocks","created_at":"2026-01-03T14:57:20.8549696-08:00","created_by":"unknown"},{"issue_id":"fabric-format-2bo","depends_on_id":"fabric-format-6rs","type":"blocks","created_at":"2026-01-03T15:07:51.6328001-08:00","created_by":"unknown"},{"issue_id":"fabric-format-2bo","depends_on_id":"fabric-format-xzv","type":"blocks","created_at":"2026-01-03T15:07:51.9093389-08:00","created_by":"unknown"},{"issue_id":"fabric-format-2bo","depends_on_id":"fabric-format-ffb","type":"blocks","created_at":"2026-01-03T15:07:52.219068-08:00","created_by":"unknown"},{"issue_id":"fabric-format-2bo","depends_on_id":"fabric-format-8is","type":"blocks","created_at":"2026-01-03T15:07:52.4695998-08:00","created_by":"unknown"},{"issue_id":"fabric-format-2bo","depends_on_id":"fabric-format-h4i","type":"blocks","created_at":"2026-01-03T15:07:52.7815109-08:00","created_by":"unknown"}]}
{"id":"fabric-format-2ei","title":"Python formatter inefficiencies","description":"Analyze and optimize the Python formatter for performance.\n\nIdentified issues:\n\n1. **Regex on every call** (lines 215-216): The regex /^(%%(\\w+).*)\\\\n?/ is created fresh on every format() call. Should compile once as a module constant.\n\n2. **Unnecessary string split** (line 247): code.split('\\\\n') creates an array even when there are no line magics. Could check for '%' first before splitting.\n\n3. **Double join** (line 268, 280): When there's a magic prefix, we join magicPrefix array and then the pythonCode lines. Multiple string concatenations.\n\n4. **Trailing newline regex on every call** (lines 232, 276): /\\\\n+\\$/ is created fresh each time. Should be a constant.\n\n5. **Redundant .trim() checks** (lines 224, 254): Multiple .trim() calls on same or related strings.\n\nLocation: python-formatter.ts format() method\n\nImpact: Minor - Ruff WASM formatting itself dominates. But worth optimizing if Python cells are common.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T16:25:50.2940432-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T16:32:32.476646-08:00","closed_at":"2026-01-03T16:32:32.476646-08:00","close_reason":"Python formatter is efficient (~0.2ms/cell). The bottleneck is in notebook-formatter.ts"}
{"id":"fabric-format-2h6","title":"Build and CLI bug fixes","description":"Fix WASM copy error handling, symlink handling, and line ending normalization","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-02T17:18:51.5972111-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-02T17:21:21.8516289-08:00","closed_at":"2026-01-02T17:21:21.8516289-08:00","close_reason":"All 3 build/CLI bugs fixed and tests passing"}
{"id":"fabric-format-2o8","title":"getTokenContext creates object on every token","description":"getTokenContext() (formatter.ts line 1213) creates a fresh object with 20+ Set.has() lookups for every token. This is called in the main token loop.\n\nOptions:\n1. Inline the lookups where needed (avoid object creation)\n2. Create a TokenContext class with lazy evaluation\n3. Pre-compute context flags in the analyzer for all tokens\n\nLocation: formatter.ts lines 1213-1244\n\nImpact: Object allocation + ~20 Set.has() calls per token.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T15:32:43.3843531-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T15:59:25.2676034-08:00","closed_at":"2026-01-03T15:59:25.2676034-08:00","close_reason":"Used reusable ctx object populated in-place each iteration instead of allocating new object with 24 properties per token. Removed getTokenContext function. All 585 tests pass."}
{"id":"fabric-format-2yv","title":"npm audit reports 1 moderate severity vulnerability","description":"npm audit reports esbuild \u003c=0.24.2 has a moderate severity vulnerability (GHSA-67mh-4wv8-2f99): enables any website to send requests to dev server. Fix: Update esbuild to 0.27.2 in packages/chromium/package.json. This is a breaking change, so test the build after updating.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-02T18:18:55.987941848Z","created_by":"runner","updated_at":"2026-01-02T15:00:48.0600886-08:00","closed_at":"2026-01-02T15:00:48.0600886-08:00","close_reason":"Updated esbuild from ^0.24.0 to ^0.27.2 in packages/chromium/package.json. Build and all 431 tests pass."}
{"id":"fabric-format-33r","title":"AGENTS.md references ~335 tests but should be verified","description":"AGENTS.md states there are '~335 tests' but this number should be verified against the actual test count. Run npm test and update the documentation to reflect the current number of tests. Add a note about how to count tests if the number changes in the future.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-02T18:18:55.89630877Z","created_by":"runner","updated_at":"2026-01-02T17:11:25.5680897-08:00","closed_at":"2026-01-02T17:11:25.5680897-08:00","close_reason":"Updated AGENTS.md to reference ~540 tests (actual count)","dependencies":[{"issue_id":"fabric-format-33r","depends_on_id":"fabric-format-c6m","type":"blocks","created_at":"2026-01-02T17:09:41.8607618-08:00","created_by":"unknown"},{"issue_id":"fabric-format-33r","depends_on_id":"fabric-format-njt","type":"related","created_at":"2026-01-02T18:19:36.451604752Z","created_by":"runner"}]}
{"id":"fabric-format-388","title":"Refactor cli.ts: Extract argument parsing and help text","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T17:36:34.9535754-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-02T17:41:57.3669527-08:00","closed_at":"2026-01-02T17:41:57.3669527-08:00","close_reason":"cli.ts at 601 lines is well-organized with 13 distinct functions. Help text and arg parsing (~150 lines combined) are tightly coupled to command execution. Extraction would add complexity without benefit.","dependencies":[{"issue_id":"fabric-format-388","depends_on_id":"fabric-format-3rm","type":"blocks","created_at":"2026-01-02T17:36:49.6387464-08:00","created_by":"unknown"}]}
{"id":"fabric-format-3e5","title":"Defer parse-tree-analyzer helper extraction - methods heavily mutate class state","description":"The private helper methods in parse-tree-analyzer.ts modify this.* Sets and Maps directly. Extracting to pure functions requires passing all state as parameters, which is invasive. Consider: 1) Splitting into multiple analyzer classes, 2) Using composition pattern, or 3) Keeping as-is since file is functional. Current size: ~1816 lines.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-02T18:18:31.6312124-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-02T21:43:19.3156953-08:00","closed_at":"2026-01-02T21:43:19.3156953-08:00","close_reason":"Deferred indefinitely - as noted, methods heavily mutate class state making extraction unsafe"}
{"id":"fabric-format-3rm","title":"Code organization: Split large files to meet 200-400 line guideline","description":"Parent issue for refactoring large files. The 200-400 line guideline exists to ensure AI agents can work effectively with files without losing context. Files over 400 lines need to be split into focused modules.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T17:35:09.4182419-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-02T19:10:28.8030504-08:00","closed_at":"2026-01-02T19:10:28.8030504-08:00","close_reason":"All child refactoring tasks completed - files now within 200-400 line guideline"}
{"id":"fabric-format-438","title":"Chromium extension manifest hardening \u0026 cleanup","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T17:02:13.5589629-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-02T17:07:00.0029862-08:00","closed_at":"2026-01-02T17:07:00.0029862-08:00","close_reason":"Completed: clipboard permission, icons, CSP, narrowed host_permissions, fixed all_frames"}
{"id":"fabric-format-44r","title":"No offline build support or caching for ANTLR dependencies","description":"No offline build support or caching for ANTLR dependencies. Every build downloads grammar files and ANTLR jar from the internet. Implement caching: check if files exist in .build/ before downloading, add checksums to verify cached files, document how to pre-download dependencies for offline builds.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-02T18:18:55.969807317Z","created_by":"runner","updated_at":"2026-01-02T21:14:19.7913974-08:00","closed_at":"2026-01-02T21:14:19.7913974-08:00","close_reason":"Not applicable - ANTLR jar (antlr4.jar) is already committed to repo in packages/core/.build/. Grammar files and generated parser files are also committed. No network required for builds."}
{"id":"fabric-format-4e5","title":"normalizeLineEndings only handles CRLF not other line ending variants","status":"closed","priority":3,"issue_type":"bug","created_at":"2026-01-02T18:19:13.574980416Z","created_by":"runner","updated_at":"2026-01-02T17:21:21.5306935-08:00","closed_at":"2026-01-02T17:21:21.5306935-08:00","close_reason":"Enhanced normalizeLineEndings to handle standalone CR in addition to CRLF","dependencies":[{"issue_id":"fabric-format-4e5","depends_on_id":"fabric-format-2h6","type":"blocks","created_at":"2026-01-02T17:18:57.4199639-08:00","created_by":"unknown"}]}
{"id":"fabric-format-4gw","title":"Formatter error messages lack context about which cell failed","description":"When any formatter fails, error messages don't include context about which cell or file failed. This makes debugging difficult in notebooks with many cells. Include cell index/ID and file path in error messages for ALL formatters (SQL, Python, and future ones). Example: 'Format error in cell 5 of notebook.py: [error details]'. Design should be extensible for future language support.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:18:55.748540084Z","created_by":"runner","updated_at":"2026-01-02T16:47:25.6879962-08:00","closed_at":"2026-01-02T16:47:25.6879962-08:00","close_reason":"Implemented: FormattingContext type flows through formatCell, formatNotebook, and CLI. Error messages now include cell index and file path. Chrome extension shows which cells failed."}
{"id":"fabric-format-4qy","title":"formatter.ts exceeds 1500 lines - violates 200-400 line guideline","description":"The formatter.ts file is 1531 lines long, exceeding the 200-400 line guideline. Split into separate modules: token processing, formatting rules, output generation, and directive handling. This will improve maintainability and make the codebase easier to navigate.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:18:55.60313143Z","created_by":"runner","updated_at":"2026-01-02T17:32:26.8842978-08:00","closed_at":"2026-01-02T17:32:26.8842978-08:00","close_reason":"Exception granted - formatter.ts contains the core formatting logic that must access shared state. 1690 lines well-organized with clear function boundaries. Splitting would add complexity without benefit.","dependencies":[{"issue_id":"fabric-format-4qy","depends_on_id":"fabric-format-ymx","type":"blocks","created_at":"2026-01-02T17:30:57.8224566-08:00","created_by":"unknown"},{"issue_id":"fabric-format-4qy","depends_on_id":"fabric-format-c62","type":"related","created_at":"2026-01-02T18:19:36.243694718Z","created_by":"runner"}]}
{"id":"fabric-format-5f5","title":"Migrate error-paths.test.ts to node:test","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T19:51:32.2425608-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-02T19:54:09.6542102-08:00","closed_at":"2026-01-02T19:54:09.6542102-08:00","close_reason":"Migration too risky - closing"}
{"id":"fabric-format-5fx","title":"Testing: Complete error path and edge case test coverage","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T19:13:15.5822129-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-02T19:24:09.893339-08:00","closed_at":"2026-01-02T19:24:09.893339-08:00","close_reason":"All 4 testing issues completed: vfh (notebook errors), f17 (edge cases), 1ys (Python init), ur0 (formatCell errors). Added 29 new tests."}
{"id":"fabric-format-5m7","title":"No clear separation between parsing and formatting in notebook-formatter","description":"In notebook-formatter.ts, parsing and formatting logic are intertwined. Separate these concerns: create a pure parser that extracts cells and metadata, and a separate formatter that transforms the parsed structure. This will make testing easier and improve code clarity.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:19:13.295261132Z","created_by":"runner","updated_at":"2026-01-02T17:32:04.0178843-08:00","closed_at":"2026-01-02T17:32:04.0178843-08:00","close_reason":"By design - notebook-formatter's intertwined parsing/formatting allows single-pass processing. Separating would add complexity without clear benefit for this opinionated tool.","dependencies":[{"issue_id":"fabric-format-5m7","depends_on_id":"fabric-format-ymx","type":"blocks","created_at":"2026-01-02T17:30:56.5916916-08:00","created_by":"unknown"}]}
{"id":"fabric-format-5vv","title":"CI failing: missing lock file and test._20 failure","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-02T15:58:07.4863989-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-02T16:03:54.0731343-08:00","closed_at":"2026-01-02T16:03:54.0731343-08:00","close_reason":"Changed CI to use npm install instead of npm ci - lock files intentionally excluded for monorepo version management"}
{"id":"fabric-format-5xs","title":"Chromium extension efficiency audit","description":"Comprehensive audit of packages/chromium/src/content.js identified multiple inefficiencies in DOM querying, event handling, object allocation, and dead code. This epic tracks all identified issues for systematic remediation. Key areas: (1) Redundant DOM queries in polling loops, (2) Duplicate event listeners, (3) Inefficient scroll container detection, (4) Object allocation waste in hot paths, (5) Dead code removal, (6) MutationObserver scope optimization.","status":"tombstone","priority":2,"issue_type":"feature","created_at":"2026-01-03T18:21:04.3223038-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T18:28:00.0450386-08:00","deleted_at":"2026-01-03T18:28:00.0450386-08:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"fabric-format-5yf","title":"No tests for CLI argument parsing and validation","description":"The CLI has no tests for argument parsing and validation. This is critical functionality (458 lines untested). Add tests for: --help, --version, --type flag, -i inline input, --print flag, invalid arguments, missing files. Use a test framework like vitest or jest.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T18:18:55.767031161Z","created_by":"runner","updated_at":"2026-01-02T15:09:00.9186319-08:00","closed_at":"2026-01-02T15:09:00.9186319-08:00","close_reason":"Added 18 new CLI argument parsing tests covering: unknown commands, --type validation, -i validation, --print constraints, missing files, type case insensitivity, and exit code verification. Total CLI tests: 39","dependencies":[{"issue_id":"fabric-format-5yf","depends_on_id":"fabric-format-i6u","type":"related","created_at":"2026-01-02T18:19:36.296967779Z","created_by":"runner"},{"issue_id":"fabric-format-5yf","depends_on_id":"fabric-format-734","type":"related","created_at":"2026-01-02T18:19:36.314328814Z","created_by":"runner"},{"issue_id":"fabric-format-5yf","depends_on_id":"fabric-format-6je","type":"related","created_at":"2026-01-02T18:19:36.331526141Z","created_by":"runner"}]}
{"id":"fabric-format-67h","title":"Type safety: Multiple uses of 'any' type in cell-formatter.ts","description":"The cell-formatter.ts file contains multiple uses of 'any' type (e.g., line 157: 'as any'). This defeats TypeScript's type safety. Replace with proper types: define specific types for Ruff options, create proper type guards for runtime type checking. This issue is blocked by fabric-format-j2o (strict mode).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:18:55.694037761Z","created_by":"runner","updated_at":"2026-01-02T21:25:25.7727816-08:00","closed_at":"2026-01-02T21:25:25.7727816-08:00","close_reason":"Fixed as part of TypeScript strict mode enablement - replaced 'any' types with proper error typing (NodeJS.ErrnoException, Error) in cli.ts"}
{"id":"fabric-format-6je","title":"No tests for --print flag in CLI","description":"No tests for the --print flag in CLI. This flag should print formatted output instead of modifying files. Add tests for: --print with single file, --print with multiple files, --print with stdin, --print with inline input (-i), verify file is not modified when --print is used.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:19:13.426523521Z","created_by":"runner","updated_at":"2026-01-02T19:33:30.2437837-08:00","closed_at":"2026-01-02T19:33:30.2437837-08:00","close_reason":"Added --print with inline input test. Existing tests already covered --print with file, --print with multiple files (error), --print with directory (error). File modification prevention verified."}
{"id":"fabric-format-6m3","title":"getComputedStyle called frequently in visibility checks","description":"Multiple functions call window.getComputedStyle() which forces style recalculation:\\n\\n1. findActiveNotebookContainer() - lines 365, 375 - checks style.display/visibility\\n2. findScrollContainer() - line 557 - checks overflowY on potentially all divs\\n3. _findCurrentlyVisibleCells() - line 477 - checks each editor's computed style\\n4. isIframeActive() - line 1141 - checks body style\\n\\ngetComputedStyle is expensive because it may trigger layout. For functions called per-cell (like _findCurrentlyVisibleCells), this adds up.\\n\\nOptimizations:\\n1. Cache computed style results within a formatting operation\\n2. Use faster checks first (offsetWidth/Height === 0) before computed style\\n3. Skip style checks for elements we already know are visible\\n\\nLocation: Multiple locations","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-03T18:39:16.6772853-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T18:39:16.6772853-08:00","dependencies":[{"issue_id":"fabric-format-6m3","depends_on_id":"fabric-format-ot3","type":"discovered-from","created_at":"2026-01-03T18:40:20.8562264-08:00","created_by":"unknown"}]}
{"id":"fabric-format-6nm","title":"Add Biome for TypeScript linting and formatting","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-02T16:07:29.7292093-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-02T16:16:20.3762422-08:00","closed_at":"2026-01-02T16:16:20.3762422-08:00","close_reason":"Implemented Biome linter and formatter with npm scripts (lint, lint:fix, format) and CI integration"}
{"id":"fabric-format-6rq","title":"Simplify formatTokens to single token array parameter","description":"With the caseInsensitive lexer grammar, we no longer need dual parsing. The formatTokens function still takes two parameters (tokenList and allOrigTokens) that are always the same array now. Refactor to take a single tokens parameter and update all internal usages.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-03T15:24:47.6529704-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T15:28:08.721507-08:00","closed_at":"2026-01-03T15:28:08.721507-08:00","close_reason":"Refactored formatTokens to take a single tokens parameter instead of two identical arrays. Also updated findForceInlineRanges and all internal usages. All 585 tests pass."}
{"id":"fabric-format-6rs","title":"Evaluate tree-sitter as ANTLR alternative","description":"Tree-sitter is a fast incremental parser used by editors like Atom/Zed/Neovim. It has WASM bindings and may be significantly faster than ANTLR4 JavaScript runtime. Investigate: 1) Does tree-sitter have a Spark SQL grammar? 2) What's the performance vs ANTLR? 3) How hard to migrate?","notes":"Tree-sitter also uses grammar files (.grammar.js) and generates parsers. Should verify it maintains grammar-driven approach before pursuing.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T15:07:13.4034975-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T15:14:03.7835404-08:00","closed_at":"2026-01-03T15:14:03.7835404-08:00","close_reason":"Not needed - SLL mode provided 4.3x speedup. Tree-sitter migration would be high effort for diminishing returns. Keep ANTLR for grammar-first approach."}
{"id":"fabric-format-6t4","title":"notebook-formatter.ts exceeds 600 lines - violates 200-400 line guideline","description":"The notebook-formatter.ts file is 644 lines long, exceeding the 200-400 line guideline. Split into separate modules: parsing logic, cell extraction, MAGIC wrapper handling, and formatting orchestration. Consider extracting language config into a separate file.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:18:55.620975486Z","created_by":"runner","updated_at":"2026-01-02T21:39:43.1790818-08:00","closed_at":"2026-01-02T21:39:43.1790818-08:00","close_reason":"Deferred - notebook-formatter is stable and works well","dependencies":[{"issue_id":"fabric-format-6t4","depends_on_id":"fabric-format-ymx","type":"blocks","created_at":"2026-01-02T17:30:57.5179197-08:00","created_by":"unknown"}]}
{"id":"fabric-format-6ts","title":"Cell formatter module couples low-level and high-level concerns","description":"The cell-formatter module mixes low-level formatting operations with high-level orchestration. Separate concerns: create a pure formatter interface that only handles code transformation, and move cell type detection, initialization, and error handling to a higher-level coordinator module.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:19:13.257174434Z","created_by":"runner","updated_at":"2026-01-02T17:32:03.2895108-08:00","closed_at":"2026-01-02T17:32:03.2895108-08:00","close_reason":"By design - cell-formatter provides a clean public API that handles initialization, error handling, and type routing. This is intentional encapsulation, not poor coupling. Tests pass, API is clean.","dependencies":[{"issue_id":"fabric-format-6ts","depends_on_id":"fabric-format-ymx","type":"blocks","created_at":"2026-01-02T17:30:56.9000237-08:00","created_by":"unknown"},{"issue_id":"fabric-format-6ts","depends_on_id":"fabric-format-5m7","type":"related","created_at":"2026-01-02T18:19:36.262081108Z","created_by":"runner"}]}
{"id":"fabric-format-6v6","title":"Extract marking helpers (identifier, clause, list, condition) from parse-tree-analyzer.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:15:03.8549132-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-02T18:23:43.0216428-08:00","closed_at":"2026-01-02T18:23:43.0216428-08:00","close_reason":"Deferred - methods mutate class state, needs architectural decision","dependencies":[{"issue_id":"fabric-format-6v6","depends_on_id":"fabric-format-lu8","type":"blocks","created_at":"2026-01-02T18:15:10.8307287-08:00","created_by":"unknown"}]}
{"id":"fabric-format-734","title":"Missing tests for stdin/stdout in CLI","description":"Missing tests for stdin/stdout in CLI. The CLI supports piping (echo 'select * from t' | fabfmt format --type sparksql) but this isn't tested. Add tests for: reading from stdin, writing to stdout, --print flag with stdin, error output to stderr, exit codes.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:19:13.407650845Z","created_by":"runner","updated_at":"2026-01-02T19:33:24.120509-08:00","closed_at":"2026-01-02T19:33:24.120509-08:00","close_reason":"Added 9 stdin/stdout tests: reading SQL/Python from stdin, multiline stdin, --print with stdin, check with stdin (formatted and unformatted), syntax errors to stderr, empty stdin handling"}
{"id":"fabric-format-735","title":"DEBUG_MODE hardcoded to true in production content.js","description":"DEBUG_MODE is hardcoded to 'true' in content.js line 16, causing verbose logging in production builds. This impacts performance and exposes internal details in console. Fix: Set DEBUG_MODE based on build environment (use process.env.NODE_ENV in esbuild define, set to false for production builds).","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-02T22:43:12.386726314Z","created_by":"runner","updated_at":"2026-01-02T15:39:08.9574366-08:00","closed_at":"2026-01-02T15:39:08.9574366-08:00","close_reason":"DEBUG_MODE is now controlled by build environment - set to false in production builds, true in development (--watch)","dependencies":[{"issue_id":"fabric-format-735","depends_on_id":"fabric-format-734","type":"related","created_at":"2026-01-02T14:57:40.437203-08:00","created_by":"import"}]}
{"id":"fabric-format-736","title":"content.js exceeds 1000 lines - violates maintainability guidelines","description":"The content.js file is 1093 lines long, far exceeding maintainability guidelines (200-400 lines). Split into modules: ui-components.ts (overlay, notifications, button), cell-operations.ts (formatting logic), dom-utils.ts (cell detection, editor extraction), initialization.ts (setup, detection). Use esbuild to bundle.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T22:43:12.404761348Z","created_by":"runner","updated_at":"2026-01-02T21:39:42.6229784-08:00","closed_at":"2026-01-02T21:39:42.6229784-08:00","close_reason":"Deferred - extension content.js refactoring is low priority","dependencies":[{"issue_id":"fabric-format-736","depends_on_id":"fabric-format-ymx","type":"blocks","created_at":"2026-01-02T17:30:55.5595301-08:00","created_by":"unknown"}]}
{"id":"fabric-format-737","title":"No error recovery if WASM file copy fails during build","description":"In build.js, if WASM file copy fails (wasmCopied = false), the build continues with only a warning. Python formatting will silently fail at runtime. Fix: Make WASM copy failure a build error (process.exit(1)), or make the copy operation required and fail the build if any path fails.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-02T22:43:12.421740516Z","created_by":"runner","updated_at":"2026-01-02T17:21:20.9029491-08:00","closed_at":"2026-01-02T17:21:20.9029491-08:00","close_reason":"Added try/catch around WASM copy in build.js with process.exit(1) on failure","dependencies":[{"issue_id":"fabric-format-737","depends_on_id":"fabric-format-738","type":"related","created_at":"2026-01-02T14:57:40.437203-08:00","created_by":"import"},{"issue_id":"fabric-format-737","depends_on_id":"fabric-format-2h6","type":"blocks","created_at":"2026-01-02T17:18:56.5283613-08:00","created_by":"unknown"}]}
{"id":"fabric-format-738","title":"investigateStorage function exposed in production (debugging code)","description":"The investigateStorage() function (lines 44-156) is debugging code exposed globally via window.__fabric_format. This is 112 lines of debug code in production. Fix: Remove or conditionally include only in development builds using the same DEBUG_MODE pattern. Wrap in if (DEBUG_MODE) block.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-02T22:43:12.438974055Z","created_by":"runner","updated_at":"2026-01-02T17:15:47.1659442-08:00","closed_at":"2026-01-02T17:15:47.1659442-08:00","close_reason":"Removed investigateStorage debug function from production code (~130 lines)","dependencies":[{"issue_id":"fabric-format-738","depends_on_id":"fabric-format-xo0","type":"blocks","created_at":"2026-01-02T17:13:19.7438075-08:00","created_by":"unknown"}]}
{"id":"fabric-format-739","title":"No tests for chromium extension content script","description":"The chromium extension has no automated tests (1093 lines of untested code). This is critical for a production browser extension. Add tests using a framework like Playwright or Puppeteer: test button injection, cell detection, format operations, error handling, WASM loading, clipboard operations.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T22:43:12.45764546Z","created_by":"runner","updated_at":"2026-01-02T15:43:04.5996707-08:00","closed_at":"2026-01-02T15:43:04.5996707-08:00","close_reason":"Added comprehensive test suite with 49 tests using JSDOM for DOM simulation","dependencies":[{"issue_id":"fabric-format-739","depends_on_id":"fabric-format-735","type":"related","created_at":"2026-01-02T14:57:40.4419193-08:00","created_by":"import"}]}
{"id":"fabric-format-740","title":"Extension uses all_frames:true which may cause performance issues","description":"Multiple setTimeout polling loops run indefinitely (lines 1046-1062, 1064-1086) without cleanup. These continue running even when the extension is not active. Fix: Store timeout IDs in variables, clear them when iframe becomes inactive, add cleanup on page unload/visibility change.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-02T22:43:12.474482383Z","created_by":"runner","updated_at":"2026-01-02T17:06:55.8240229-08:00","closed_at":"2026-01-02T17:06:55.8240229-08:00","close_reason":"Changed PowerBI content script from all_frames:true to all_frames:false","dependencies":[{"issue_id":"fabric-format-740","depends_on_id":"fabric-format-438","type":"blocks","created_at":"2026-01-02T17:02:24.0929129-08:00","created_by":"unknown"}]}
{"id":"fabric-format-741","title":"Hardcoded CSS styles in JavaScript should use CSS files","description":"MutationObserver is created on line 1064 but never disconnected. This is a memory leak - the observer continues running even when no longer needed. Fix: Store observer in a variable, call observer.disconnect() when iframe becomes inactive or on cleanup. Add proper lifecycle management.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-02T22:43:12.491432396Z","created_by":"runner","updated_at":"2026-01-02T21:48:32.8347079-08:00","closed_at":"2026-01-02T21:48:32.8347079-08:00","close_reason":"Already fixed - MutationObserver uses trackObserver() which registers it for cleanup on page unload. The cleanup handler at line 130-155 disconnects all tracked observers via beforeunload/unload events.","dependencies":[{"issue_id":"fabric-format-741","depends_on_id":"fabric-format-740","type":"related","created_at":"2026-01-02T14:57:40.4429273-08:00","created_by":"import"}]}
{"id":"fabric-format-742","title":"Multiple setTimeout polling loops without cleanup","description":"TODO comment in sql-formatter.ts line 66: 'TODO: Add options support to formatSql in the future'. This has been there a while. Either: 1) Implement options support (lineWidth, indentation, etc.), 2) Create a GitHub issue for tracking and remove the TODO, 3) Document decision not to add options (opinionated formatter philosophy).","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-02T22:43:12.510187459Z","created_by":"runner","updated_at":"2026-01-02T17:27:43.528-08:00","closed_at":"2026-01-02T17:27:43.528-08:00","close_reason":"Not a bug - timeouts ARE tracked with trackTimeout(), description was corrupted from wrong issue","dependencies":[{"issue_id":"fabric-format-742","depends_on_id":"fabric-format-wg2","type":"blocks","created_at":"2026-01-02T17:25:10.6812987-08:00","created_by":"unknown"}]}
{"id":"fabric-format-743","title":"MutationObserver never disconnected - potential memory leak","description":"No .editorconfig file in the repository. This leads to inconsistent formatting across different editors (tabs vs spaces, line endings, etc.). Add .editorconfig with settings: indent_style = space, indent_size = 2 (for JS) and 4 (for TS), end_of_line = lf, charset = utf-8, trim_trailing_whitespace = true.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-02T22:43:12.526772415Z","created_by":"runner","updated_at":"2026-01-02T15:48:07.8620191-08:00","closed_at":"2026-01-02T15:48:07.8620191-08:00","close_reason":"Added cleanup handlers for MutationObserver, intervals, and timeouts on page unload"}
{"id":"fabric-format-744","title":"TODO comment in sql-formatter.ts never addressed","description":"No prettier or eslint configuration files. Code formatting and linting is inconsistent across the codebase. Add: .prettierrc.json with line width, quote style, trailing comma settings. Add .eslintrc.json with TypeScript rules, import order, unused variable detection. Add to package.json scripts.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-02T22:43:12.543658974Z","created_by":"runner","updated_at":"2026-01-02T17:15:46.9142242-08:00","closed_at":"2026-01-02T17:15:46.9142242-08:00","close_reason":"Removed stale TODO - formatSql API is intentionally simple by design","dependencies":[{"issue_id":"fabric-format-744","depends_on_id":"fabric-format-xo0","type":"blocks","created_at":"2026-01-02T17:13:19.3802639-08:00","created_by":"unknown"}]}
{"id":"fabric-format-745","title":"No .editorconfig for consistent formatting across editors","description":"No GitHub Actions CI workflow for automated testing. Every PR should run tests, linting, and builds automatically. Create .github/workflows/ci.yml: run npm test on push/PR, run builds for all packages, run linting, test on multiple Node versions, cache node_modules for speed.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-02T22:43:12.562622456Z","created_by":"runner","updated_at":"2026-01-02T17:15:45.8451726-08:00","closed_at":"2026-01-02T17:15:45.8451726-08:00","close_reason":"Added .editorconfig with UTF-8, LF, 2-space indent defaults","dependencies":[{"issue_id":"fabric-format-745","depends_on_id":"fabric-format-746","type":"related","created_at":"2026-01-02T14:57:40.4445009-08:00","created_by":"import"},{"issue_id":"fabric-format-745","depends_on_id":"fabric-format-xo0","type":"blocks","created_at":"2026-01-02T17:13:18.414654-08:00","created_by":"unknown"}]}
{"id":"fabric-format-746","title":"No prettier or eslint configuration files","description":"No pre-commit hooks configured. Developers can commit code that doesn't pass tests or linting. Set up husky + lint-staged: run prettier on staged files, run eslint, run type checking. This catches issues before they reach CI. Add to package.json devDependencies and configure in .husky/pre-commit.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T22:43:12.581635152Z","created_by":"runner","updated_at":"2026-01-02T16:08:29.5950564-08:00","closed_at":"2026-01-02T16:08:29.5950564-08:00","close_reason":"Superseded by fabric-format-6nm (Biome replaces both ESLint and Prettier)","dependencies":[{"issue_id":"fabric-format-746","depends_on_id":"fabric-format-6nm","type":"related","created_at":"2026-01-02T16:08:22.588805-08:00","created_by":"unknown"}]}
{"id":"fabric-format-747","title":"Package.json has empty author field in chromium package","description":"Test framework uses custom implementation (packages/core/src/tests/framework.ts) instead of standard tools like Jest/Vitest/Mocha. This means missing features: watch mode, coverage, parallel execution, better assertions. Evaluate migration to a standard framework or document why custom is needed.","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-02T22:43:12.600846807Z","created_by":"runner","updated_at":"2026-01-02T17:15:46.6449966-08:00","closed_at":"2026-01-02T17:15:46.6449966-08:00","close_reason":"Added author field to chromium package.json","dependencies":[{"issue_id":"fabric-format-747","depends_on_id":"fabric-format-xo0","type":"blocks","created_at":"2026-01-02T17:13:18.9842832-08:00","created_by":"unknown"}]}
{"id":"fabric-format-748","title":"No GitHub Actions CI workflow for automated testing","description":"Tests don't run in CI - only locally. There's no automation preventing broken code from being merged. This issue is related to fabric-format-745 (no CI workflow). Once CI is set up, ensure 'npm test' is run on every PR and push to main branch.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T22:43:12.617939919Z","created_by":"runner","updated_at":"2026-01-02T15:50:33.2352281-08:00","closed_at":"2026-01-02T15:50:33.2352281-08:00","close_reason":"Created .github/workflows/ci.yml with Node.js matrix testing","dependencies":[{"issue_id":"fabric-format-748","depends_on_id":"fabric-format-745","type":"related","created_at":"2026-01-02T14:57:40.4454469-08:00","created_by":"import"}]}
{"id":"fabric-format-749","title":"No pre-commit hooks configured (git hooks)","description":"No code coverage reporting configured. We don't know what percentage of code is tested. Add coverage tooling: nyc for custom framework, or switch to Jest/Vitest which have built-in coverage. Set up coverage thresholds (e.g., 80% minimum) and integrate with CI to fail builds below threshold.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T22:43:12.636482402Z","created_by":"runner","updated_at":"2026-01-02T17:15:46.325901-08:00","closed_at":"2026-01-02T17:15:46.325901-08:00","close_reason":"Added .githooks/pre-commit with biome check and prepare script to configure git hooks","dependencies":[{"issue_id":"fabric-format-749","depends_on_id":"fabric-format-6nm","type":"related","created_at":"2026-01-02T16:08:34.0999794-08:00","created_by":"unknown"},{"issue_id":"fabric-format-749","depends_on_id":"fabric-format-xo0","type":"blocks","created_at":"2026-01-02T17:13:18.7281825-08:00","created_by":"unknown"}]}
{"id":"fabric-format-750","title":"Test framework uses custom implementation instead of standard tools","description":"Package.json in chromium package has empty author field (line 20: author: ''). This should contain author information for the extension store. Fill in: 'author': 'Jacob Knightley' or 'author': { 'name': 'Jacob Knightley', 'email': '...' }.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T22:43:12.655330817Z","created_by":"runner","updated_at":"2026-01-02T19:54:16.5950963-08:00","closed_at":"2026-01-02T19:54:16.5950963-08:00","close_reason":"Custom test framework is appropriate for this project - migration too risky for minimal benefit","dependencies":[{"issue_id":"fabric-format-750","depends_on_id":"fabric-format-1qn","type":"blocks","created_at":"2026-01-02T19:51:59.318505-08:00","created_by":"unknown"},{"issue_id":"fabric-format-750","depends_on_id":"fabric-format-v79","type":"blocks","created_at":"2026-01-02T19:51:59.8144652-08:00","created_by":"unknown"},{"issue_id":"fabric-format-750","depends_on_id":"fabric-format-5f5","type":"blocks","created_at":"2026-01-02T19:52:00.3171811-08:00","created_by":"unknown"},{"issue_id":"fabric-format-750","depends_on_id":"fabric-format-ux1","type":"blocks","created_at":"2026-01-02T19:52:00.8182397-08:00","created_by":"unknown"},{"issue_id":"fabric-format-750","depends_on_id":"fabric-format-mb8","type":"blocks","created_at":"2026-01-02T19:52:01.5052774-08:00","created_by":"unknown"}]}
{"id":"fabric-format-751","title":"No code coverage reporting configured","description":"formatCell has inconsistent error reporting: it returns {error: string} on failure, but formatNotebook throws exceptions. This forces consumers to handle errors differently depending on which API they use. Standardize: either both throw, both return Result type, or document when to use each pattern and why.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T22:43:12.674373828Z","created_by":"runner","updated_at":"2026-01-02T21:36:51.5598653-08:00","closed_at":"2026-01-02T21:36:51.5598653-08:00","close_reason":"Added c8 code coverage: npm run test:coverage. Current coverage: 90.25% lines, 87.82% branches. Added c8 config to exclude tests and generated files. Documented in CONTRIBUTING.md.","dependencies":[{"issue_id":"fabric-format-751","depends_on_id":"fabric-format-754","type":"related","created_at":"2026-01-02T14:57:40.4454469-08:00","created_by":"import"}]}
{"id":"fabric-format-752","title":"Tests don't run in CI - only locally","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T22:43:12.69299729Z","created_by":"runner","updated_at":"2026-01-02T15:50:33.5559902-08:00","closed_at":"2026-01-02T15:50:33.5559902-08:00","close_reason":"CI workflow now runs tests on every PR and push"}
{"id":"fabric-format-753","title":"formatCell has inconsistent error reporting (error field vs exceptions)","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-02T22:43:12.711760194Z","created_by":"runner","updated_at":"2026-01-02T17:24:30.9981833-08:00","closed_at":"2026-01-02T17:24:30.9981833-08:00","close_reason":"Not a bug - formatCell API is consistent: always returns {formatted, changed, error?} and never throws","dependencies":[{"issue_id":"fabric-format-753","depends_on_id":"fabric-format-8io","type":"blocks","created_at":"2026-01-02T17:22:04.5784452-08:00","created_by":"unknown"}]}
{"id":"fabric-format-754","title":"Python formatter initialization is async but not awaited everywhere","description":"Python formatter initialization is async (initializePythonFormatter) but the initialization check (pythonFormatterReady) is synchronous. This can cause race conditions where formatCell is called while initialization is in progress. Fix: Make all initialization checks await the init promise, or use a state machine (uninitialized/initializing/ready/error).","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-02T22:43:12.730262347Z","created_by":"runner","updated_at":"2026-01-02T15:55:31.065937-08:00","closed_at":"2026-01-02T15:55:31.065937-08:00","close_reason":"Added formatCellAsync() that waits for in-progress initialization before formatting","dependencies":[{"issue_id":"fabric-format-754","depends_on_id":"fabric-format-755","type":"related","created_at":"2026-01-02T14:57:40.4454469-08:00","created_by":"import"}]}
{"id":"fabric-format-755","title":"No retry logic for transient WASM initialization failures","description":"No retry logic for transient WASM initialization failures. If WASM download fails due to network issues, the formatter permanently fails. Add retry logic: retry 3 times with exponential backoff, only fail permanently after all retries exhausted. Log retry attempts for debugging.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-02T22:43:12.750714825Z","created_by":"runner","updated_at":"2026-01-02T17:24:30.7348233-08:00","closed_at":"2026-01-02T17:24:30.7348233-08:00","close_reason":"Added retry logic with 3 attempts and exponential backoff (500ms, 1000ms, 2000ms delays)","dependencies":[{"issue_id":"fabric-format-755","depends_on_id":"fabric-format-8io","type":"blocks","created_at":"2026-01-02T17:22:03.9547218-08:00","created_by":"unknown"}]}
{"id":"fabric-format-756","title":"Extension content script has no way to report errors to users","description":"Extension content script has no way to report initialization errors to users. If WASM fails to load or formatters fail to initialize, the button appears but silently fails. Fix: Show user-visible error notifications for initialization failures, disable the format button, or show a different UI state.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-02T22:43:12.769736781Z","created_by":"runner","updated_at":"2026-01-02T17:24:30.321179-08:00","closed_at":"2026-01-02T17:24:30.321179-08:00","close_reason":"Added error notification on WASM initialization failure, now shows user-visible error message with reload suggestion","dependencies":[{"issue_id":"fabric-format-756","depends_on_id":"fabric-format-8io","type":"blocks","created_at":"2026-01-02T17:22:03.6772098-08:00","created_by":"unknown"}]}
{"id":"fabric-format-757","title":"Cell type detection relies on brittle DOM queries","description":"Cell type detection relies on brittle DOM queries (data-mode-id attribute, lang- class). If Fabric changes their DOM structure, detection breaks. Make detection more robust: use multiple fallback strategies, add error recovery, log warnings when using fallbacks, document which Fabric versions are supported.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-02T22:43:12.787865713Z","created_by":"runner","updated_at":"2026-01-02T17:27:43.2178246-08:00","closed_at":"2026-01-02T17:27:43.2178246-08:00","close_reason":"Added 5 fallback detection strategies: data-mode-id, lang- class, language- class, cell container class, and content heuristics","dependencies":[{"issue_id":"fabric-format-757","depends_on_id":"fabric-format-wg2","type":"blocks","created_at":"2026-01-02T17:25:10.4024732-08:00","created_by":"unknown"}]}
{"id":"fabric-format-758","title":"Extension requests broad host_permissions for all fabric.microsoft.com","description":"Extension requests broad host_permissions for 'https://*.fabric.microsoft.com/*'. This grants access to all Fabric pages, not just notebooks. Apply principle of least privilege: narrow to specific paths like '*/synapsenotebooks/*' or '*/pbides.powerbi.com/*'. Document why broader permissions are needed if truly required.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-02T22:43:12.807170722Z","created_by":"runner","updated_at":"2026-01-02T17:06:55.5874569-08:00","closed_at":"2026-01-02T17:06:55.5874569-08:00","close_reason":"Narrowed host_permissions from wildcards to specific subdomains (app.fabric, app.powerbi, pbides.powerbi)","dependencies":[{"issue_id":"fabric-format-758","depends_on_id":"fabric-format-759","type":"related","created_at":"2026-01-02T14:57:40.4454469-08:00","created_by":"import"},{"issue_id":"fabric-format-758","depends_on_id":"fabric-format-438","type":"blocks","created_at":"2026-01-02T17:02:23.83246-08:00","created_by":"unknown"}]}
{"id":"fabric-format-759","title":"No Content Security Policy defined in extension manifest","description":"No Content Security Policy (CSP) defined in extension manifest.json. CSP helps prevent XSS attacks by restricting script sources. Add 'content_security_policy' field to manifest: 'script-src': 'self', 'object-src': 'self'. Test that extension still works with CSP enabled.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-02T22:43:12.824803652Z","created_by":"runner","updated_at":"2026-01-02T17:06:55.2591094-08:00","closed_at":"2026-01-02T17:06:55.2591094-08:00","close_reason":"Added content_security_policy with wasm-unsafe-eval for WASM support","dependencies":[{"issue_id":"fabric-format-759","depends_on_id":"fabric-format-438","type":"blocks","created_at":"2026-01-02T17:02:23.4265565-08:00","created_by":"unknown"}]}
{"id":"fabric-format-760","title":"clipboard.writeText used without permission in manifest","description":"Extension uses navigator.clipboard.writeText() (line 487) but manifest.json doesn't declare 'clipboardWrite' permission. This causes the extension to fail in strict permission environments or future Chrome versions. Fix: Add 'permissions': ['clipboardWrite'] to manifest.json. This BLOCKS fabric-format-758.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-02T22:43:12.8446486Z","created_by":"runner","updated_at":"2026-01-02T17:06:48.3644014-08:00","closed_at":"2026-01-02T17:06:48.3644014-08:00","close_reason":"Added clipboardWrite permission to manifest.json","dependencies":[{"issue_id":"fabric-format-760","depends_on_id":"fabric-format-758","type":"blocks","created_at":"2026-01-02T14:57:40.4560947-08:00","created_by":"import"},{"issue_id":"fabric-format-760","depends_on_id":"fabric-format-438","type":"blocks","created_at":"2026-01-02T17:02:22.6346924-08:00","created_by":"unknown"}]}
{"id":"fabric-format-761","title":"formatAllCells scrolls to every cell - slow for large notebooks","description":"formatAllCells scrolls to every cell to render content (lines 691, 700-717). For large notebooks (100+ cells), this is slow and causes visible scrolling. Optimize: use IntersectionObserver to only process visible cells, implement virtual scrolling, or batch process cells without scrolling. Target: \u003c5 seconds for 100-cell notebook.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-02T22:43:12.86428665Z","created_by":"runner","updated_at":"2026-01-02T17:27:43.7905325-08:00","closed_at":"2026-01-02T17:27:43.7905325-08:00","close_reason":"By design - Monaco virtualization requires scrolling to render cell content. Using instant scroll and minimal polling delays.","dependencies":[{"issue_id":"fabric-format-761","depends_on_id":"fabric-format-762","type":"related","created_at":"2026-01-02T14:57:40.4581746-08:00","created_by":"import"},{"issue_id":"fabric-format-761","depends_on_id":"fabric-format-wg2","type":"blocks","created_at":"2026-01-02T17:25:10.0168985-08:00","created_by":"unknown"}]}
{"id":"fabric-format-762","title":"No debouncing on MutationObserver callbacks","description":"No debouncing on MutationObserver callbacks (line 1064). Every DOM change triggers the callback, potentially creating performance issues in notebooks with frequent updates. Add debouncing: use lodash.debounce or custom debounce function with 250ms delay. Only check for button injection after mutations settle.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-02T22:43:12.881343972Z","created_by":"runner","updated_at":"2026-01-02T17:27:42.852115-08:00","closed_at":"2026-01-02T17:27:42.852115-08:00","close_reason":"Added debounce utility function and wrapped MutationObserver callback with 250ms debounce","dependencies":[{"issue_id":"fabric-format-762","depends_on_id":"fabric-format-wg2","type":"blocks","created_at":"2026-01-02T17:25:09.750218-08:00","created_by":"unknown"}]}
{"id":"fabric-format-763","title":"500ms polling interval for button injection is inefficient","description":"Button injection uses 500ms polling interval (line 1062). This wastes CPU cycles checking every 500ms even when nothing changes. Improve: use MutationObserver exclusively (no polling), or increase interval to 2-5 seconds, or only poll when document.visibilityState changes to 'visible'.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-02T22:43:12.900567622Z","created_by":"runner","updated_at":"2026-01-02T21:43:19.0254921-08:00","closed_at":"2026-01-02T21:43:19.0254921-08:00","close_reason":"Already addressed - now uses named TIMING.BUTTON_POLL_INTERVAL_MS constant and the interval is appropriate for the use case","dependencies":[{"issue_id":"fabric-format-763","depends_on_id":"fabric-format-762","type":"related","created_at":"2026-01-02T14:57:40.4586853-08:00","created_by":"import"}]}
{"id":"fabric-format-764","title":"PRIVACY.md exists but content not checked for completeness","description":"PRIVACY.md exists in packages/chromium/ but content hasn't been verified for completeness. Required for extension store submission. Verify it covers: what data is collected (none), what permissions are used and why, data transmission (WASM loaded locally), third-party services (none), update policy.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-02T22:43:12.919337389Z","created_by":"runner","updated_at":"2026-01-02T21:33:25.390695-08:00","closed_at":"2026-01-02T21:33:25.390695-08:00","close_reason":"Reviewed PRIVACY.md - content is complete. Covers: no data collection, local-only processing, permissions explanation, third-party libs (Ruff, ANTLR), contact info, last updated date. Ready for Chrome Web Store submission."}
{"id":"fabric-format-765","title":"No documentation for how to debug the extension","description":"No documentation for how to debug the extension. Debugging browser extensions requires special knowledge. Add docs: how to view extension console logs, how to reload extension during development, how to debug content script (use Sources tab), common issues (WASM loading, clipboard permissions), testing in different Fabric pages.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-02T22:43:12.939487011Z","created_by":"runner","updated_at":"2026-01-02T21:29:32.6572077-08:00","closed_at":"2026-01-02T21:29:32.6572077-08:00","close_reason":"Added extension debugging section to CONTRIBUTING with logs, breakpoints, reload instructions, and common issues"}
{"id":"fabric-format-766","title":"Extension manifest.json missing icons field","description":"Extension manifest.json is missing the 'icons' field. Chrome Web Store and Edge Add-ons require icons (16x16, 48x48, 128x128). Without icons, the extension shows a generic icon in the browser. Add icons: create icon files in assets/, reference them in manifest.json 'icons' field.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-02T22:43:12.957478121Z","created_by":"runner","updated_at":"2026-01-02T17:06:54.8947939-08:00","closed_at":"2026-01-02T17:06:54.8947939-08:00","close_reason":"Added icons field with 16x16, 48x48, 128x128 PNG icons","dependencies":[{"issue_id":"fabric-format-766","depends_on_id":"fabric-format-438","type":"blocks","created_at":"2026-01-02T17:02:22.9301301-08:00","created_by":"unknown"}]}
{"id":"fabric-format-767","title":"README doesn't mention browser compatibility requirements","description":"README.md doesn't mention browser compatibility requirements. Users need to know which browsers are supported and minimum versions. Add section: Chrome 100+, Edge 100+, Firefox 100+ (if supported). Note any browser-specific limitations (e.g., clipboard API support).","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-02T22:43:12.976565766Z","created_by":"runner","updated_at":"2026-01-02T21:29:32.3900254-08:00","closed_at":"2026-01-02T21:29:32.3900254-08:00","close_reason":"Added browser compatibility table to README (Chrome 88+, Edge 88+, Firefox/Safari not supported)"}
{"id":"fabric-format-768","title":"Inconsistent promise handling - mix of async/await and .then()","description":"Inconsistent promise handling throughout content.js: some functions use async/await (lines 169-184), others use .then() callbacks (lines 97-122). This makes code harder to follow. Standardize on async/await throughout for consistency and better error handling with try-catch.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-02T22:43:12.995130738Z","created_by":"runner","updated_at":"2026-01-02T21:42:37.9402732-08:00","closed_at":"2026-01-02T21:42:37.9402732-08:00","close_reason":"Already fixed - codebase uses async/await consistently. Only .then() found was in a documentation example."}
{"id":"fabric-format-769","title":"Magic numbers throughout content.js (100, 50, 500ms delays)","description":"Magic numbers scattered throughout content.js: 100ms (line 459), 50ms (lines 474, 480, 762), 500ms (lines 1017, 1062), 30ms (line 700), 60 attempts (line 699). These should be named constants: const SCROLL_WAIT_MS = 100, const PASTE_DELAY_MS = 50, etc. Makes intent clear and allows tuning in one place.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-02T22:43:13.013335594Z","created_by":"runner","updated_at":"2026-01-02T21:42:18.0272523-08:00","closed_at":"2026-01-02T21:42:18.0272523-08:00","close_reason":"Replaced magic numbers with named TIMING constants with JSDoc comments"}
{"id":"fabric-format-770","title":"No logging levels - all logs use console.log/warn/error","description":"No logging levels in content.js. All logs use console.log/warn/error directly. Add a proper logging system with levels (debug, info, warn, error), controlled by DEBUG_MODE. Example: log.debug() only outputs when DEBUG_MODE=true, log.error() always outputs. Use a logging library or implement simple wrapper.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-02T22:43:13.032852297Z","created_by":"runner","updated_at":"2026-01-02T21:43:49.9783281-08:00","closed_at":"2026-01-02T21:43:49.9783281-08:00","close_reason":"Won't fix - DEBUG_MODE toggle already provides debug/production separation"}
{"id":"fabric-format-771","title":"extractCodeFromEditor assumes specific Monaco DOM structure","description":"extractCodeFromEditor (line 422) assumes specific Monaco DOM structure (.view-lines .view-line). If Monaco's internal DOM changes, extraction breaks. Make it more robust: add fallback extraction methods, use Monaco's API if available (though it's not in content script context), add error detection for unexpected structure.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-02T22:43:13.052903753Z","created_by":"runner","updated_at":"2026-01-02T17:27:42.4019229-08:00","closed_at":"2026-01-02T17:27:42.4019229-08:00","close_reason":"Added 3 fallback extraction strategies: direct .view-line, lines-content container, and innerText fallback","dependencies":[{"issue_id":"fabric-format-771","depends_on_id":"fabric-format-wg2","type":"blocks","created_at":"2026-01-02T17:25:09.4785766-08:00","created_by":"unknown"}]}
{"id":"fabric-format-772","title":"No versioning strategy for breaking API changes","description":"No versioning strategy for breaking API changes. The library is at v0.0.5 but there's no documented plan for v1.0.0 or handling breaking changes. Define strategy: use semantic versioning strictly, document breaking changes in CHANGELOG, provide migration guides, deprecate features before removing (with warnings).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T22:43:13.071351393Z","created_by":"runner","updated_at":"2026-01-02T21:12:07.0831177-08:00","closed_at":"2026-01-02T21:12:07.0831177-08:00","close_reason":"Not applicable - this is an opinionated formatter with no public API surface. No programmatic consumers to worry about breaking. Pre-1.0 semver allows breaking changes anyway."}
{"id":"fabric-format-773","title":"Package exports field incomplete - missing subpath exports","description":"Package exports field in package.json is incomplete. It only exports the main entry point ('.'). Consider adding subpath exports for direct access to formatters: './sql', './python', './formatters'. This allows tree-shaking and more flexible imports. Example: import { formatSql } from '@jacobknightley/fabric-format/sql'.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-02T22:43:13.089563598Z","created_by":"runner","updated_at":"2026-01-02T21:48:27.1820342-08:00","closed_at":"2026-01-02T21:48:27.1820342-08:00","close_reason":"Added subpath exports for ./sql, ./python, and ./formatters to package.json. Enables tree-shaking and direct imports."}
{"id":"fabric-format-7hf","title":"Research case-insensitive ANTLR lexer options","description":"ANTLR's JavaScript runtime doesn't support case-insensitive lexing out of the box. Research options:\n1. ANTLR4 CaseInsensitiveCharStream (may need custom implementation)\n2. Lexer actions to normalize casing\n3. Preprocessing vs grammar-level solutions\n4. Alternative: use a JS lexer for tokenization, ANTLR only for parsing","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T14:57:27.1789879-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T15:00:19.6815478-08:00","closed_at":"2026-01-03T15:00:19.6815478-08:00","close_reason":"Research complete. ANTLR4 4.7+ supports grammar-level caseInsensitive option:\n\n**Solution**: Add 'options { caseInsensitive = true; }' to SqlBaseLexer.g4\n\nThis makes the lexer match keywords regardless of case, eliminating the need for:\n1. Converting SQL to uppercase before parsing\n2. Dual lexing (uppercase for parsing, original for text)\n\nThe grammar will match 'select', 'SELECT', 'Select' as the same SELECT token.\n\nWe still need original text for identifiers, but the token's text property already preserves original casing. We just need to use token.text from the original input stream.\n\n**Implementation approach**:\n1. Add caseInsensitive option to lexer grammar\n2. Regenerate lexer/parser\n3. Modify formatter.ts to single-pass parsing\n4. Use token positions to extract original text\n\nEstimated performance improvement: ~40-50% (eliminating one full parse cycle)"}
{"id":"fabric-format-85b","title":"Refactor content.js: Extract UI components (notifications, buttons, overlay)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T17:36:33.4451267-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-02T17:41:27.7241151-08:00","closed_at":"2026-01-02T17:41:27.7241151-08:00","close_reason":"Content scripts in browser extensions are bundled into a single file. The code is already well-organized with 14 clear sections. Splitting would not reduce complexity due to bundling.","dependencies":[{"issue_id":"fabric-format-85b","depends_on_id":"fabric-format-3rm","type":"blocks","created_at":"2026-01-02T17:36:48.615434-08:00","created_by":"unknown"}]}
{"id":"fabric-format-8g0","title":"Profile SQL formatter to identify actual bottlenecks","description":"Run profiling tools on realistic SQL formatting workloads to identify where time is actually spent. Use Node.js profiling or --inspect to collect data.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-03T14:50:35.9910547-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T14:57:09.3475578-08:00","closed_at":"2026-01-03T14:57:09.3475578-08:00","close_reason":"Profiled SQL formatter. Key findings:\n- ~60% of time in ANTLR (parsing/lexing): closure_, equalsFunction, execATNWithFullContext\n- ~14.5% in LoadIC_Megamorphic (V8 polymorphic property access)\n- ~1.4% in formatTokens (actual formatting)\n- ~0.3% in ParseTreeAnalyzer methods\n\nANTLR dominates. Dual-parsing (uppercase + original) doubles this cost. ParseTreeAnalyzer is NOT the bottleneck.","dependencies":[{"issue_id":"fabric-format-8g0","depends_on_id":"fabric-format-yki","type":"blocks","created_at":"2026-01-03T14:50:50.3014565-08:00","created_by":"unknown"}]}
{"id":"fabric-format-8hk","title":"Remove redundant DOM queries in formatAllCells loop","description":"In formatAllCells(), the loop re-queries cellContainer.querySelector('.monaco-editor') at line 943 and again at line 965 inside the stability loop.\\n\\n**CONTEXT:**\\nThe re-query inside the stability loop is INTENTIONAL. Monaco/Fabric may recreate DOM elements during virtualization. The editor element from before the stability loop might become stale (disconnected from DOM) during the polling period.\\n\\n**SAFE OPTIMIZATION:**\\n1. Query once at line 943 for the focus operation\\n2. Only re-query inside the loop if the element becomes disconnected (check isConnected)\\n3. Pattern: editor = editor?.isConnected ? editor : cellContainer.querySelector('.monaco-editor')\\n\\n**DOWNGRADING to P3** - the double query is defensive programming, not a bug.\\n\\nLocation: content.js lines 943, 965","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-03T18:32:05.8939586-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T18:45:21.2267-08:00","dependencies":[{"issue_id":"fabric-format-8hk","depends_on_id":"fabric-format-pzt","type":"related","created_at":"2026-01-03T18:33:30.0668257-08:00","created_by":"unknown"},{"issue_id":"fabric-format-8hk","depends_on_id":"fabric-format-ot3","type":"discovered-from","created_at":"2026-01-03T18:33:56.8297399-08:00","created_by":"unknown"}]}
{"id":"fabric-format-8io","title":"Error handling improvements","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T17:21:59.122475-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-02T17:24:31.2652435-08:00","closed_at":"2026-01-02T17:24:31.2652435-08:00","close_reason":"All error handling improvements complete"}
{"id":"fabric-format-8is","title":"Research ANTLR4 performance tuning options","description":"Before replacing ANTLR, exhaust optimization options: 1) SLL prediction mode vs LL (faster but may fail on ambiguous grammars), 2) Lexer modes to reduce token alternatives, 3) Grammar refactoring to reduce ATN complexity, 4) antlr4-c3 or other optimized runtimes.","notes":"SUCCESS! Implemented two-stage SLL parsing. Results: 4.3x faster overall (6.32 ms/KB -\u003e 1.45 ms/KB).\n\nWHAT IS SLL?\nSLL (Strong LL) is a simpler, faster prediction algorithm in ANTLR4:\n\n- **LL mode**: Full adaptive LL(*) - explores all possible parse paths, handles any ambiguity. Slower because it must consider context from the entire call stack.\n\n- **SLL mode**: Ignores parser call stack context. Makes predictions based only on the current decision point. Much faster but can fail on grammars with certain ambiguities.\n\nWHY IT WORKS FOR SQL:\nMost SQL statements are unambiguous at each decision point. SLL handles 99%+ of real-world SQL without needing the full LL algorithm. When SLL fails (throws exception), we catch it and retry with full LL mode.\n\nTWO-STAGE PATTERN (from ANTLR docs):\n1. Try SLL first (fast path)\n2. On failure, reset token stream and retry with LL (slow but correct)\n\nThis is the same pattern used by major ANTLR-based tools like Presto/Trino SQL parser.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T15:07:30.4374847-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T15:14:14.7294856-08:00","closed_at":"2026-01-03T15:12:39.5029776-08:00","close_reason":"Implemented two-stage SLL parsing. 4.3x performance improvement (6.32 ms/KB -\u003e 1.45 ms/KB). All 529 tests passing."}
{"id":"fabric-format-8qs","title":"Missing error handling for fs operations in cli.ts","description":"The CLI (cli.ts) performs fs operations (readFileSync, writeFileSync, statSync) without error handling. If a file is locked, doesn't exist, or has permission issues, the CLI will crash with an unhelpful error. Wrap all fs operations in try-catch blocks and provide user-friendly error messages.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-02T18:18:55.712375326Z","created_by":"runner","updated_at":"2026-01-02T15:03:15.9317826-08:00","closed_at":"2026-01-02T15:03:15.9317826-08:00","close_reason":"Added proper error handling for all fs operations in cli.ts with user-friendly messages for permission denied, file not found, file locked, and read-only filesystem errors"}
{"id":"fabric-format-8s0","title":"No documentation for WasmInitOptions in public API","description":"The WasmInitOptions type is exported in the public API but lacks documentation. Add JSDoc explaining: what it's for (Chrome extension WASM loading), the wasmUrl field (URL to .wasm file), the wasmBinary field (ArrayBuffer for sync init), and when to use each option.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:19:13.501564678Z","created_by":"runner","updated_at":"2026-01-02T17:11:25.8900604-08:00","closed_at":"2026-01-02T17:11:25.8900604-08:00","close_reason":"Added comprehensive JSDoc with examples for WasmInitOptions","dependencies":[{"issue_id":"fabric-format-8s0","depends_on_id":"fabric-format-c6m","type":"blocks","created_at":"2026-01-02T17:09:42.5987984-08:00","created_by":"unknown"},{"issue_id":"fabric-format-8s0","depends_on_id":"fabric-format-cpr","type":"related","created_at":"2026-01-02T18:19:36.417633732Z","created_by":"runner"}]}
{"id":"fabric-format-96z","title":"Extract span calculation helpers from parse-tree-analyzer.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:14:53.8173263-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-02T18:17:51.1342158-08:00","closed_at":"2026-01-02T18:17:51.1342158-08:00","close_reason":"Extracted calculateSpanLength and calculateNormalizedSpanLength to span-calculator.ts","dependencies":[{"issue_id":"fabric-format-96z","depends_on_id":"fabric-format-lu8","type":"blocks","created_at":"2026-01-02T18:15:09.8970853-08:00","created_by":"unknown"}]}
{"id":"fabric-format-9br","title":"Audit codebase for legacy case-insensitive workarounds","description":"Now that SqlBaseLexer.g4 uses caseInsensitive=true, review the formatter codebase for any remaining case-insensitive assumptions or workarounds that are no longer needed. Examples to look for: toUpperCase() calls on SQL input, case-insensitive string comparisons for keywords, duplicate logic for handling upper/lower case variants. This is a code hygiene task - cleaner code, not necessarily performance.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-03T15:05:43.5043791-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T15:25:01.0413005-08:00","closed_at":"2026-01-03T15:25:01.0413005-08:00","close_reason":"Audit complete. Found 11 toUpperCase() and 2 toLowerCase() calls - all are NECESSARY for: (1) Output formatting - uppercasing keywords in formatted SQL, (2) Case-insensitive lookups against builtin function sets, (3) Hex/binary literal detection (X'...' or B'...'). No legacy parsing workarounds found. Created fabric-format-6rq for optional cleanup of the dual-parameter formatTokens API signature."}
{"id":"fabric-format-9c5","title":"Function expansion breaks IN list wrapping","description":"When an IN list wraps due to line width, nested functions like CAST inside the list items incorrectly expand, breaking mid-expression. Example: WHERE id IN (CAST(...), CAST( breaks with CONV on next line instead of keeping each CAST on its own line. Fix: suppress function expansion when inside an active IN list.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-03T17:36:57.3358573-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T18:08:45.9071879-08:00","closed_at":"2026-01-03T18:08:45.9071879-08:00","close_reason":"Fixed: 1) Added collectDepth tracking in parse-tree-analyzer to only mark top-level IN list commas. 2) Added insideInList suppression for function expansion. Added 3 regression tests."}
{"id":"fabric-format-9wz","title":"File extension validation not centralized in CLI","description":"File extension validation (checking for .py, .sql, .scala, .r) appears in multiple places in CLI. Centralize this into a single constant SUPPORTED_EXTENSIONS and a utility function isSupportedFile(path). This makes it easier to add new file types and keeps validation consistent.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-02T18:19:13.332515354Z","created_by":"runner","updated_at":"2026-01-02T21:48:22.7001828-08:00","closed_at":"2026-01-02T21:48:22.7001828-08:00","close_reason":"Added isSupportedFile utility function and exported SUPPORTED_EXTENSIONS constant from CLI. Centralized file extension validation."}
{"id":"fabric-format-a7u","title":"Circular import risk between formatters/index.ts and individual formatters","description":"There's a circular import risk between formatters/index.ts (registry) and individual formatters (sql, python). The registry imports formatters, which may import from the registry. Refactor to use dependency injection or a factory pattern to break the circular dependency.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:19:13.519953533Z","created_by":"runner","updated_at":"2026-01-02T17:31:55.7588806-08:00","closed_at":"2026-01-02T17:31:55.7588806-08:00","close_reason":"Not a bug - circular import is not occurring. Individual formatters (sparksql, python) don't import from formatters/index.ts. The registry imports formatters, but formatters don't import the registry.","dependencies":[{"issue_id":"fabric-format-a7u","depends_on_id":"fabric-format-ymx","type":"blocks","created_at":"2026-01-02T17:30:55.8841497-08:00","created_by":"unknown"},{"issue_id":"fabric-format-a7u","depends_on_id":"fabric-format-6ts","type":"related","created_at":"2026-01-02T18:19:36.279307803Z","created_by":"runner"}]}
{"id":"fabric-format-acg","title":"Inconsistent async/sync API: formatCellSync only for sparksql","description":"The API has inconsistent async/sync patterns: formatCellSync exists only for sparksql, but not for python. Either provide sync versions for both languages (if possible) or make all APIs async for consistency. Document why sync is not available for Python (WASM async requirement).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:18:56.024661662Z","created_by":"runner","updated_at":"2026-01-02T19:37:10.0376048-08:00","closed_at":"2026-01-02T19:37:10.0376048-08:00","close_reason":"Documented the async/sync API patterns in cell-formatter.ts. Added table showing which functions work for which languages and why Python cannot be sync (WASM requires async init). The current API is correct - formatCellSync restricts to sparksql at type level."}
{"id":"fabric-format-atx","title":"index.ts comment block references 'formatters/sql/' but actual path is 'formatters/sparksql/'","description":"The index.ts comment block references 'formatters/sql/' but the actual directory path is 'formatters/sparksql/'. Update the comment to match the actual code structure. Search for other references to 'formatters/sql/' in comments and update them.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-02T18:19:13.463966846Z","created_by":"runner","updated_at":"2026-01-02T17:11:24.9416712-08:00","closed_at":"2026-01-02T17:11:24.9416712-08:00","close_reason":"Fixed comment to reference formatters/sparksql/ instead of formatters/sql/","dependencies":[{"issue_id":"fabric-format-atx","depends_on_id":"fabric-format-c6m","type":"blocks","created_at":"2026-01-02T17:09:41.1251827-08:00","created_by":"unknown"},{"issue_id":"fabric-format-atx","depends_on_id":"fabric-format-jpq","type":"related","created_at":"2026-01-02T18:19:36.468199918Z","created_by":"runner"}]}
{"id":"fabric-format-au2","title":"findScrollContainer does expensive DOM scan","description":"findScrollContainer() (lines 340-370) queries all divs in the document and checks getComputedStyle on each when known selectors don't match. This is called once per formatAllCells invocation.\\n\\nOn complex Fabric pages, this could be thousands of elements.\\n\\nOptimizations:\\n1. Cache the result - scroll container won't change during a format operation\\n2. Start from notebook container instead of document\\n3. Limit search to first N levels of DOM depth\\n\\nLower priority as it runs once per Format All, not per cell.\\n\\nLocation: content.js lines 340-370","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-03T18:33:06.092709-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T18:33:06.092709-08:00","dependencies":[{"issue_id":"fabric-format-au2","depends_on_id":"fabric-format-ot3","type":"discovered-from","created_at":"2026-01-03T18:33:59.2256784-08:00","created_by":"unknown"}]}
{"id":"fabric-format-bnl","title":"SQL Formatter Performance Inefficiencies","description":"Analysis of compute waste and consolidation opportunities in the SQL formatter. Each sub-issue represents a specific optimization.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T15:32:07.9782084-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T16:23:42.4570031-08:00","closed_at":"2026-01-03T16:23:42.4570031-08:00","close_reason":"All child optimizations completed","dependencies":[{"issue_id":"fabric-format-bnl","depends_on_id":"fabric-format-d8c","type":"blocks","created_at":"2026-01-03T15:34:00.2920828-08:00","created_by":"unknown"},{"issue_id":"fabric-format-bnl","depends_on_id":"fabric-format-cq0","type":"blocks","created_at":"2026-01-03T15:34:27.6617782-08:00","created_by":"unknown"},{"issue_id":"fabric-format-bnl","depends_on_id":"fabric-format-vzp","type":"blocks","created_at":"2026-01-03T15:34:27.9192007-08:00","created_by":"unknown"},{"issue_id":"fabric-format-bnl","depends_on_id":"fabric-format-ig0","type":"blocks","created_at":"2026-01-03T15:34:28.2201345-08:00","created_by":"unknown"},{"issue_id":"fabric-format-bnl","depends_on_id":"fabric-format-2o8","type":"blocks","created_at":"2026-01-03T15:34:28.4761732-08:00","created_by":"unknown"},{"issue_id":"fabric-format-bnl","depends_on_id":"fabric-format-eet","type":"blocks","created_at":"2026-01-03T15:34:28.7684321-08:00","created_by":"unknown"},{"issue_id":"fabric-format-bnl","depends_on_id":"fabric-format-dms","type":"blocks","created_at":"2026-01-03T15:34:29.0263899-08:00","created_by":"unknown"},{"issue_id":"fabric-format-bnl","depends_on_id":"fabric-format-i9w","type":"blocks","created_at":"2026-01-03T15:34:29.289519-08:00","created_by":"unknown"},{"issue_id":"fabric-format-bnl","depends_on_id":"fabric-format-p88","type":"blocks","created_at":"2026-01-03T15:34:29.548842-08:00","created_by":"unknown"}]}
{"id":"fabric-format-bxc","title":"formatCell returns success:false but formatNotebook throws exceptions","description":"Inconsistent error handling: formatCell returns {error: string} while formatNotebook throws exceptions. Standardize error handling across the API. Recommendation: use a Result type or consistently throw exceptions for all public APIs.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:18:56.005803394Z","created_by":"runner","updated_at":"2026-01-02T19:39:32.0557182-08:00","closed_at":"2026-01-02T19:39:32.0557182-08:00","close_reason":"Documented the error handling design in notebook-formatter.ts. Explains the intentional difference: NotebookStructureError (thrown) for fatal structural issues vs stats.errors (returned) for recoverable cell formatting errors. Added example code showing how to handle both.","dependencies":[{"issue_id":"fabric-format-bxc","depends_on_id":"fabric-format-acg","type":"related","created_at":"2026-01-02T18:19:36.3836481Z","created_by":"runner"}]}
{"id":"fabric-format-c62","title":"cli.ts exceeds 450 lines - violates 200-400 line guideline","description":"The cli.ts file is 458 lines long, exceeding the 200-400 line guideline. Split into modules: argument parsing, file discovery, formatting operations, and output handling. Consider using a CLI framework like commander or yargs.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:18:55.638998836Z","created_by":"runner","updated_at":"2026-01-02T21:39:42.8910167-08:00","closed_at":"2026-01-02T21:39:42.8910167-08:00","close_reason":"Deferred - CLI is stable and works well","dependencies":[{"issue_id":"fabric-format-c62","depends_on_id":"fabric-format-ymx","type":"blocks","created_at":"2026-01-02T17:30:57.213657-08:00","created_by":"unknown"}]}
{"id":"fabric-format-c6m","title":"Documentation and code comment cleanup","description":"Fix stale comments, wrong paths, add missing JSDoc for public API","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T17:09:35.911032-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-02T17:11:31.0933197-08:00","closed_at":"2026-01-02T17:11:31.0933197-08:00","close_reason":"Completed: fixed stale comments, wrong paths, added JSDoc for WasmInitOptions, updated test count"}
{"id":"fabric-format-cfw","title":"Eliminate dual-parsing overhead in SQL formatter","description":"Current approach parses SQL twice:\n1. Uppercase SQL for grammar matching (ANTLR lexer is case-sensitive)\n2. Original SQL for preserving text casing\n\nProfiling shows ~60% of time is in ANTLR parsing. Eliminating dual-parsing could nearly halve formatting time.\n\nOptions to explore:\n- Modify ANTLR grammar to be case-insensitive (may require grammar changes)\n- Cache parser/lexer instances\n- Single-pass approach: parse once, carry both uppercase tokens and original text","notes":"Implemented case-insensitive lexer and single-pass parsing. Changes: (1) Added options caseInsensitive=true to SqlBaseLexer.g4, (2) Regenerated lexer/parser, (3) Refactored formatter.ts to single-pass parsing. Benchmark: ~3% improvement (6.32 ms/KB down from 6.52 ms/KB). The bottleneck is ANTLR ATN simulation itself, not dual-parsing. Further gains would require bypassing ANTLR.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-03T14:57:16.9990031-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T15:04:12.5785524-08:00","closed_at":"2026-01-03T15:04:12.5785524-08:00","close_reason":"Implemented caseInsensitive lexer option and single-pass parsing. Achieved ~3% performance improvement. ATN simulation is the true bottleneck (not addressable without replacing ANTLR).","dependencies":[{"issue_id":"fabric-format-cfw","depends_on_id":"fabric-format-7hf","type":"blocks","created_at":"2026-01-03T14:57:30.7420843-08:00","created_by":"unknown"}]}
{"id":"fabric-format-ch7","title":"Inconsistent use of types vs interfaces throughout codebase","description":"The codebase inconsistently uses 'type' and 'interface' for type definitions. TypeScript best practice: use interface for public APIs and object shapes, use type for unions, intersections, and complex types. Standardize usage across the codebase for consistency. Examples: FormatterOptions should be interface, CellType should be type union.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:18:55.675314626Z","created_by":"runner","updated_at":"2026-01-02T21:42:56.235094-08:00","closed_at":"2026-01-02T21:42:56.235094-08:00","close_reason":"By design - using interface for object shapes and type for unions/aliases follows TypeScript best practices"}
{"id":"fabric-format-cpr","title":"Missing JSDoc for public API functions in index.ts","description":"Public API functions in index.ts lack JSDoc comments. Add comprehensive JSDoc for all exported functions including: purpose, parameters, return values, examples, and any exceptions thrown. This is critical for library consumers.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:18:56.063966973Z","created_by":"runner","updated_at":"2026-01-02T17:11:26.306848-08:00","closed_at":"2026-01-02T17:11:26.306848-08:00","close_reason":"Enhanced package documentation header with @packageDocumentation","dependencies":[{"issue_id":"fabric-format-cpr","depends_on_id":"fabric-format-c6m","type":"blocks","created_at":"2026-01-02T17:09:42.2373282-08:00","created_by":"unknown"}]}
{"id":"fabric-format-cq0","title":"Duplicate getSymbolicName implementation in output-helpers.ts","description":"output-helpers.ts defines its own local getSymbolicName() function (line 20) that duplicates token-utils.ts. Should import from token-utils.ts instead.\n\nLocation: output-helpers.ts line 20\n\nImpact: Code duplication, maintenance burden. Minor performance impact.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T15:32:20.7642483-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T15:38:49.3125566-08:00","closed_at":"2026-01-03T15:38:49.3125566-08:00","close_reason":"Removed duplicate, now imports from token-utils.ts"}
{"id":"fabric-format-d8c","title":"Move constant Sets outside hot path (determineOutputText)","description":"In formatter.ts determineOutputText(), partitionTransformFunctions, structuralKeywords, and extensionKeywords are recreated on every token. Move to module-level constants.\n\nLocation: formatter.ts lines 1014-1030, 1278-1310, 1317-1330\n\nImpact: O(n) Set allocations per statement, where n=token count.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T15:32:15.368791-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T15:38:48.9591676-08:00","closed_at":"2026-01-03T15:38:48.9591676-08:00","close_reason":"Moved PARTITION_TRANSFORM_FUNCTIONS, STRUCTURAL_KEYWORDS, EXTENSION_KEYWORDS to module-level constants"}
{"id":"fabric-format-dms","title":"findForceInlineRanges scans all tokens after analysis","description":"findForceInlineRanges() does a separate O(n) pass through all tokens looking for fmt:inline comments, then iterates over all multiArgFunctionInfo, windowDefInfo, and pivotInfo maps for each comment found.\n\nThis could be integrated into the ParseTreeAnalyzer visitor to avoid the extra pass.\n\nLocation: formatter.ts lines 1050-1140\n\nImpact: Extra O(n) token scan + O(m*k) lookups where m=comments, k=expandable constructs.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T15:32:58.5727386-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T16:22:45.4749074-08:00","closed_at":"2026-01-03T16:22:45.4749074-08:00","close_reason":"Changed forceInlineRanges from array to Set for O(1) lookup instead of O(n) array.some()"}
{"id":"fabric-format-eet","title":"OutputBuilder uses array of strings for output","description":"OutputBuilder collects output into string[] and joins at the end:\n\nprivate output: string[] = [];\n\npush(text: string): void {\n  this.output.push(text);\n  this.updateColumn(text);\n}\n\ntoString(): string {\n  return this.output.join('').trim();\n}\n\nModern JS engines handle string concatenation efficiently with internal rope/cord structures. Using += or template literals might be faster for this use case. Need benchmarking to verify.\n\nAdditionally, getLastChar() repeatedly accesses the last element and takes the last character - could cache this.\n\nLocation: output-builder.ts lines 12-60\n\nImpact: Unclear - needs benchmarking. Array push vs string concat.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T15:32:51.307485-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T16:23:42.0060475-08:00","closed_at":"2026-01-03T16:23:42.0060475-08:00","close_reason":"Cache lastChar on push instead of computing it each time getLastChar is called"}
{"id":"fabric-format-f17","title":"Missing edge case tests for empty files and empty cells","description":"Missing edge case tests for empty files and empty cells. Add tests for: completely empty file, file with only whitespace, cells with only comments, cells with only blank lines, zero-length strings. Ensure these cases don't crash and return appropriate results.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:18:55.841053239Z","created_by":"runner","updated_at":"2026-01-02T19:21:32.4383218-08:00","closed_at":"2026-01-02T19:21:32.4383218-08:00","close_reason":"Added edge case tests in error-paths.test.ts: empty string, whitespace-only SQL/Python, comment-only cells, blank-line cells","dependencies":[{"issue_id":"fabric-format-f17","depends_on_id":"fabric-format-vfh","type":"related","created_at":"2026-01-02T18:19:36.366418092Z","created_by":"runner"},{"issue_id":"fabric-format-f17","depends_on_id":"fabric-format-5fx","type":"blocks","created_at":"2026-01-02T19:13:22.4703733-08:00","created_by":"unknown"}]}
{"id":"fabric-format-f2l","title":"findSupportedFiles doesn't handle symlinks","status":"closed","priority":3,"issue_type":"bug","created_at":"2026-01-02T18:19:13.59405268Z","created_by":"runner","updated_at":"2026-01-02T17:21:21.2735902-08:00","closed_at":"2026-01-02T17:21:21.2735902-08:00","close_reason":"Added symlink handling in findSupportedFiles using isSymbolicLink() and statSync","dependencies":[{"issue_id":"fabric-format-f2l","depends_on_id":"fabric-format-2h6","type":"blocks","created_at":"2026-01-02T17:18:57.157234-08:00","created_by":"unknown"}]}
{"id":"fabric-format-ffb","title":"Explore chevrotain as ANTLR alternative","description":"Chevrotain is a pure JavaScript parser combinator library. Claims 10x faster than ANTLR. Investigate: 1) Can we express Spark SQL grammar in chevrotain? 2) Benchmark comparison with ANTLR. 3) Migration complexity - chevrotain uses different paradigm (code-based vs grammar files).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T15:07:24.1909388-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T15:08:59.2463509-08:00","closed_at":"2026-01-03T15:08:59.2463509-08:00","close_reason":"Rejected: Chevrotain uses code-based parser combinators, not grammar files. Would violate 100% grammar-driven architecture."}
{"id":"fabric-format-gqo","title":"setCodeViaPaste has redundant scrollIntoView","description":"setCodeViaPaste() (line 609) calls scrollIntoView() and waits 100ms (SCROLL_SETTLE_MS) even when called from formatAllCells which already scrolled.\\n\\n**REASSESSMENT:**\\nThis is actually CORRECT behavior. Between the initial scroll in formatAllCells and calling setCodeViaPaste, we do:\\n1. Focus the editor\\n2. Wait for stability (up to 3 seconds of polling)\\n3. Format the code\\n\\nDuring this time, the user's view may have shifted, or the cell may have scrolled out of the virtualization window. The scroll in setCodeViaPaste ensures the editor is still in view when we paste.\\n\\n**CLOSING as not-a-bug** - the redundant scroll is intentional safety.\\n\\nLocation: content.js line 609-612","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-03T18:32:40.9626463-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T18:44:53.8893894-08:00","closed_at":"2026-01-03T18:44:53.8893894-08:00","close_reason":"Not a bug - the second scroll in setCodeViaPaste is intentional. During stability checking (up to 3s), the view may shift. Re-scrolling ensures the editor is visible when we paste.","dependencies":[{"issue_id":"fabric-format-gqo","depends_on_id":"fabric-format-tf3","type":"related","created_at":"2026-01-03T18:33:34.3679648-08:00","created_by":"unknown"},{"issue_id":"fabric-format-gqo","depends_on_id":"fabric-format-ot3","type":"discovered-from","created_at":"2026-01-03T18:33:58.3033886-08:00","created_by":"unknown"}]}
{"id":"fabric-format-h4i","title":"Consider partial/lazy parsing for formatting","description":"Full AST may not be needed for formatting. Investigate: 1) Can we tokenize only and skip full parse for simple queries? 2) Lazy parse tree construction - only expand nodes we need, 3) Early termination when we have enough context for formatting decisions.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-03T15:07:36.422738-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T15:09:03.2997247-08:00","closed_at":"2026-01-03T15:09:03.2997247-08:00","close_reason":"Rejected: Partial/lazy parsing would require heuristics outside the grammar. Would violate 100% grammar-driven architecture."}
{"id":"fabric-format-h6v","title":"formatCell result comparison uses === on strings","description":"After formatting, we compare:\\n\\nif (result.formatted === originalCode) {\\n  alreadyFormatted++;\\n  continue;\\n}\\n\\nThis is an O(n) string comparison. For cells that are already formatted (common case), we're comparing potentially large strings.\\n\\nThe formatCell function already returns a 'changed' boolean - we should use that instead of re-comparing strings:\\n\\nif (!result.changed) {\\n  alreadyFormatted++;\\n  continue;\\n}\\n\\nLocation: content.js line 1030","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-03T18:40:02.303241-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T18:40:02.303241-08:00","dependencies":[{"issue_id":"fabric-format-h6v","depends_on_id":"fabric-format-ot3","type":"discovered-from","created_at":"2026-01-03T18:40:23.2543899-08:00","created_by":"unknown"}]}
{"id":"fabric-format-hm6","title":"SQL_STYLE_GUIDE.md has typo: 'Meanign' should be 'Meaning'","description":"SQL_STYLE_GUIDE.md has a typo on line 3: 'Meanign' should be 'Meaning'. Fix the typo. [Note: This was already fixed in the first iteration]","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-02T18:18:55.932240325Z","created_by":"runner","updated_at":"2026-01-02T14:57:40.3854775-08:00","closed_at":"2026-01-02T18:20:23.844253131Z","close_reason":"Fixed typo in SQL_STYLE_GUIDE.md"}
{"id":"fabric-format-i6u","title":"No tests for directory traversal and file discovery in CLI","description":"No tests for directory traversal and file discovery in the CLI. The findSupportedFiles() function recursively walks directories - this needs testing. Add tests for: nested directories, mixed file types, excluding node_modules/.git, symlinks, empty directories, permission errors.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T18:18:55.785297721Z","created_by":"runner","updated_at":"2026-01-02T15:18:07.4116782-08:00","closed_at":"2026-01-02T15:18:07.4116782-08:00","close_reason":"Added 21 tests for directory traversal and file discovery: nested directories, mixed file types, excluded directories (node_modules, .git, __pycache__, venv, dist, build), symlinks, empty directories, multiple paths, and check command with directories"}
{"id":"fabric-format-i9w","title":"Next token lookahead in main loop is O(k) per token","description":"In the main token loop, we find the next non-WS token with O(k) scan:\n\nfor (let j = i + 1; j \u003c tokens.length; j++) {\n  const nextToken = tokens[j];\n  if (nextToken.type !== SqlBaseLexer.WS \u0026\u0026 ...) {\n    nextTokenType = nextToken.type;\n    break;\n  }\n}\n\nThis is repeated for many decisions (lookahead for '(', etc.).\n\nCould precompute next-non-ws indices for all tokens in O(n), then lookup in O(1).\n\nLocation: formatter.ts lines 667-680\n\nImpact: O(k*n) where k=average WS tokens between real tokens.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T15:33:06.2267201-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T15:41:18.9165454-08:00","closed_at":"2026-01-03T15:41:18.9165454-08:00","close_reason":"Precomputed next-non-WS index array with O(n) build and O(1) lookup, replacing O(k) scan per token"}
{"id":"fabric-format-ig0","title":"Inefficient isInListComma in newline-calculator.ts","description":"isInListComma() function iterates over all IN lists on every call to check if a token is inside any IN list:\n\nfor (const [_, inListInfo] of analysis.inListInfo) {\n  const isAfterOpen = tokenIndex \u003e inListInfo.openParenIndex;\n  const isBeforeClose = tokenIndex \u003c inListInfo.closeParenIndex;\n  const isComma = inListInfo.commaIndices.includes(tokenIndex);\n  ...\n}\n\nThis is O(m*k) where m=number of IN lists, k=comma count per list.\n\nBetter approach: Pre-compute a Set of all IN list comma token indices in the analyzer.\n\nLocation: newline-calculator.ts lines 79-94\n\nImpact: Significant for queries with multiple IN lists.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T15:32:36.5536322-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T15:43:44.2980667-08:00","closed_at":"2026-01-03T15:43:44.2980667-08:00","close_reason":"Pre-computed allInListCommas Set for O(1) lookup, eliminating O(m*k) iteration over all IN lists"}
{"id":"fabric-format-j2o","title":"TypeScript strict mode disabled in tsconfig.base.json","description":"TypeScript strict mode is disabled in tsconfig.base.json (strict: false). This allows unsafe code patterns like implicit any, null coercion, and missing property checks. Enable strict mode to catch type errors at compile time. This blocks fixing 2 other issues (fabric-format-67h and fabric-format-ch7) which require strict mode to be properly addressed.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T18:18:35.246682435Z","created_by":"runner","updated_at":"2026-01-02T21:25:21.3493359-08:00","closed_at":"2026-01-02T21:25:21.3493359-08:00","close_reason":"Enabled TypeScript strict mode in tsconfig.base.json. Fixed all strict mode errors across cli.ts, python-formatter.ts, formatter.ts, formatting-context.ts, and newline-calculator.ts.","dependencies":[{"issue_id":"fabric-format-j2o","depends_on_id":"fabric-format-67h","type":"blocks","created_at":"2026-01-02T18:19:36.155355174Z","created_by":"runner"},{"issue_id":"fabric-format-j2o","depends_on_id":"fabric-format-ch7","type":"blocks","created_at":"2026-01-02T18:19:36.174159552Z","created_by":"runner"}]}
{"id":"fabric-format-jpq","title":"Comment says 'sparkfmt' but package is 'fabric-format'","description":"The index.ts file has a comment 'sparkfmt - Spark SQL \u0026 Python Formatter' but the package is named fabric-format. Update the comment to match the actual package name. This is a minor inconsistency but can confuse new contributors. Also check for other references to 'sparkfmt' in comments.","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-02T18:19:13.369909315Z","created_by":"runner","updated_at":"2026-01-02T17:11:25.3229136-08:00","closed_at":"2026-01-02T17:11:25.3229136-08:00","close_reason":"Updated sparkfmt references to @jacobknightley/fabric-format in index.ts and sql-formatter.ts","dependencies":[{"issue_id":"fabric-format-jpq","depends_on_id":"fabric-format-c6m","type":"blocks","created_at":"2026-01-02T17:09:41.5033779-08:00","created_by":"unknown"}]}
{"id":"fabric-format-jwv","title":"KeyboardEvent dispatch creates objects per cell","description":"In setCodeViaPaste(), we create two KeyboardEvent objects per cell:\\n1. Ctrl+A for select all (line 643-653)\\n2. ClipboardEvent for paste (line 661-665)\\n\\nFor 50 cells, that's 100 event objects created and garbage collected.\\n\\nOptimizations:\\n1. Create reusable event templates at module scope\\n2. Or use a single pre-created event and modify properties\\n\\nNote: This is likely a minor optimization compared to the DOM/timing issues, but worth noting for completeness.\\n\\nLocation: content.js lines 643-665","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-03T18:39:25.4329606-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T18:39:25.4329606-08:00","dependencies":[{"issue_id":"fabric-format-jwv","depends_on_id":"fabric-format-ot3","type":"discovered-from","created_at":"2026-01-03T18:40:21.351539-08:00","created_by":"unknown"}]}
{"id":"fabric-format-k2q","title":"Race condition possible if initializePythonFormatter called multiple times","description":"If initializePythonFormatter() is called multiple times concurrently, there's a race condition. Multiple callers might create separate initialization promises, leading to duplicate WASM loads or inconsistent state. Add proper synchronization: check if initialization is in progress before starting a new one, and ensure all callers wait for the same promise.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-02T18:19:13.556881322Z","created_by":"runner","updated_at":"2026-01-02T15:35:56.0115235-08:00","closed_at":"2026-01-02T15:35:56.0115235-08:00","close_reason":"Fixed race condition by ensuring pythonFormatterInitPromise is assigned synchronously before any await. Added error recovery to reset promise on failure. Added tests for concurrent initialization and promise state management."}
{"id":"fabric-format-l69","title":"CLI performance regression - format command is much slower than expected","description":"The CLI is significantly slower than before when formatting multiple files. Investigation found that Python formatter initialization is called inside formatNotebook() for EVERY file, even though it's idempotent. While initializePythonFormatter() has a fast path for already-initialized state, it still incurs await overhead on every file. Additionally, the CLI processes files sequentially rather than in parallel. Potential fixes: 1) Initialize Python formatter ONCE at CLI startup before file loop; 2) Consider parallel file processing with Promise.all or a worker pool.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-02T22:07:03.049068-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-02T22:10:21.4523064-08:00","closed_at":"2026-01-02T22:10:21.4523064-08:00","close_reason":"Fixed by initializing Python formatter once at CLI startup before the file processing loop"}
{"id":"fabric-format-lu8","title":"Refactor parse-tree-analyzer.ts: Extract visitor method groups to separate modules","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T17:36:32.6951879-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-02T18:23:54.1882216-08:00","closed_at":"2026-01-02T18:23:54.1882216-08:00","close_reason":"Partial extraction complete: span-calculator.ts extracted (~360 lines). Remaining helpers mutate class state - deferred to fabric-format-3e5. File reduced from 2176 to 1816 lines.","dependencies":[{"issue_id":"fabric-format-lu8","depends_on_id":"fabric-format-3rm","type":"blocks","created_at":"2026-01-02T17:36:47.9044581-08:00","created_by":"unknown"}]}
{"id":"fabric-format-mb8","title":"Update test runner index.ts to use node:test for integration tests","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T19:51:33.7882649-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-02T19:54:10.7340113-08:00","closed_at":"2026-01-02T19:54:10.7340113-08:00","close_reason":"Migration too risky - closing"}
{"id":"fabric-format-mme","title":"parseFloat called on every line during sort","description":"extractCodeFromEditor() sorts lines by parsing style.top:\\n\\nArray.sort() comparison function is called O(n log n) times. For 100 lines, that's ~700 parseFloat calls per sort.\\n\\n**THIS IS A VALID OPTIMIZATION TARGET** (related to fabric-format-su3).\\n\\n1. **Pre-compute values** - Create array of {element, top} pairs, parse once, then sort.\\n2. **Use Schwartzian transform** - Map to [parsedTop, element], sort by [0], map back.\\n\\nExample:\\nconst withTops = Array.from(lines).map(el =\u003e [parseFloat(el.style.top) || 0, el]);\\nwithTops.sort((a, b) =\u003e a[0] - b[0]);\\nconst sortedLines = withTops.map(pair =\u003e pair[1]);\\n\\nThis is pure optimization, no timing concerns. Combine with fabric-format-su3 for a single fix.\\n\\nLocation: content.js lines 604-608","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-03T18:39:46.6909705-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T19:41:20.1682305-08:00","closed_at":"2026-01-03T19:41:20.1682305-08:00","close_reason":"Fixed in fabric-format-su3: parseFloat values are now pre-computed before sorting","dependencies":[{"issue_id":"fabric-format-mme","depends_on_id":"fabric-format-ot3","type":"discovered-from","created_at":"2026-01-03T18:40:22.3119447-08:00","created_by":"unknown"},{"issue_id":"fabric-format-mme","depends_on_id":"fabric-format-su3","type":"related","created_at":"2026-01-03T18:40:29.5232619-08:00","created_by":"unknown"}]}
{"id":"fabric-format-nf2","title":"formatting-context.ts exceeds 400 lines - approaches upper limit","description":"The formatting-context.ts file is 449 lines, approaching the 400-line upper limit. Monitor for future growth and consider splitting if it exceeds 400 lines. Potential split points: state management, utility functions, and type definitions.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-02T18:18:55.656697434Z","created_by":"runner","updated_at":"2026-01-02T17:32:27.4769388-08:00","closed_at":"2026-01-02T17:32:27.4769388-08:00","close_reason":"At 416 lines, formatting-context.ts is just above the soft limit. Well-organized with types and state management. No action needed.","dependencies":[{"issue_id":"fabric-format-nf2","depends_on_id":"fabric-format-ymx","type":"blocks","created_at":"2026-01-02T17:30:58.6904912-08:00","created_by":"unknown"}]}
{"id":"fabric-format-njt","title":"AGENTS.md says tests are in packages/core/src/tests/ but structure unclear","description":"AGENTS.md says tests are in packages/core/src/tests/ but doesn't clarify the subdirectory structure (sparksql/, python/, integration/). Add a section documenting the test organization pattern: feature-based modules in sparksql/, Ruff integration tests in python/, CLI and file parsing tests in integration/.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-02T18:19:13.482663216Z","created_by":"runner","updated_at":"2026-01-02T21:43:39.2634012-08:00","closed_at":"2026-01-02T21:43:39.2634012-08:00","close_reason":"Already documented - Test Structure section in AGENTS.md clearly shows test directory organization"}
{"id":"fabric-format-no1","title":"Clipboard API is slow - consider execCommand fallback","description":"setCodeViaPaste() uses navigator.clipboard.writeText() which is async.\\n\\n**REASSESSMENT:**\\nThe clipboard API is the standard way to interact with the clipboard. Alternatives:\\n\\n1. **execCommand('insertText')** - Deprecated, may not work in all contexts\\n2. **Direct clipboard data on event** - We already do this, but also write to actual clipboard as backup\\n\\nThe actual performance impact is likely minimal since:\\n- It's called once per cell (not in the hot path)\\n- The async overhead is small compared to the stability waiting\\n- We need clipboard permissions anyway\\n\\n**DOWNGRADING to P4** - This is a micro-optimization with uncertain benefit and risk of breaking paste.\\n\\nLocation: content.js lines 659-667","status":"open","priority":4,"issue_type":"task","created_at":"2026-01-03T18:39:06.8809064-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T18:46:28.2370835-08:00","dependencies":[{"issue_id":"fabric-format-no1","depends_on_id":"fabric-format-ot3","type":"discovered-from","created_at":"2026-01-03T18:40:20.2902802-08:00","created_by":"unknown"}]}
{"id":"fabric-format-nqf","title":"detectCellType runs 5 strategies sequentially","description":"detectCellType() (lines 227-285) tries 5 different strategies to detect cell language, always running them in sequence even if an earlier one should have succeeded.\\n\\nFor Format All with 50 cells, this function runs 50 times. Strategies 4 and 5 do expensive DOM queries (closest(), querySelectorAll).\\n\\nOptimizations:\\n1. Early return is already in place but querySelectorAll in strategy 3 runs even if strategy 1/2 succeeded (review flow)\\n2. Cache detection results per editor element\\n3. Strategy 5 (heuristic from content) should be avoided - if we get there, something's wrong\\n\\nLower priority since this runs once per cell, not in a loop.\\n\\nLocation: content.js lines 227-285","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-03T18:32:58.4534902-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T18:32:58.4534902-08:00","dependencies":[{"issue_id":"fabric-format-nqf","depends_on_id":"fabric-format-ot3","type":"discovered-from","created_at":"2026-01-03T18:33:58.759089-08:00","created_by":"unknown"}]}
{"id":"fabric-format-ocr","title":"String replace for nbsp done on every line","description":"extractCodeFromEditor() calls .replace(/\\\\u00a0/g, ' ') on every span and every line:\\n\\nLine 616: lineText += span.textContent.replace(/\\\\u00a0/g, ' ');\\nLine 618: lineText = line.textContent.replace(/\\\\u00a0/g, ' ');\\n\\n**THIS IS A VALID OPTIMIZATION TARGET.**\\nWe can safely optimize this without affecting the stability checking logic:\\n\\n1. **Single replace at end** - Concatenate all text first, then do ONE replace on the final string\\n2. **Use replaceAll** - String.replaceAll('\\\\u00a0', ' ') is cleaner (available in modern browsers)\\n3. **Check first** - If text doesn't contain nbsp (indexOf === -1), skip replace entirely\\n\\nThis is pure string manipulation, no DOM timing concerns.\\n\\nExample optimization:\\nconst rawText = codeLines.join('\\\\n');\\nreturn rawText.includes('\\\\u00a0') ? rawText.replaceAll('\\\\u00a0', ' ') : rawText;\\n\\nLocation: content.js lines 595-618","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T18:39:38.1763744-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T19:39:29.5533255-08:00","closed_at":"2026-01-03T19:39:29.5533255-08:00","close_reason":"Optimized: single nbsp replace at end instead of per-span","dependencies":[{"issue_id":"fabric-format-ocr","depends_on_id":"fabric-format-ot3","type":"discovered-from","created_at":"2026-01-03T18:40:21.8479883-08:00","created_by":"unknown"},{"issue_id":"fabric-format-ocr","depends_on_id":"fabric-format-pzt","type":"related","created_at":"2026-01-03T18:40:29.0453659-08:00","created_by":"unknown"}]}
{"id":"fabric-format-oko","title":"Polling loop does redundant DOM queries every 500ms","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-03T18:20:20.1209863-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T18:28:01.5550218-08:00","deleted_at":"2026-01-03T18:28:01.5550218-08:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"fabric-format-ot3","title":"Chromium extension post-click performance audit","description":"Parent issue tracking performance improvements for the Chromium extension after the Format button is clicked.\\n\\n## CRITICAL CONTEXT\\n\\n**The stability checking loop exists for a reason** (fabric-format-ska):\\n- Monaco lazy-loads text content even after scroll+focus\\n- Empty .view-line divs appear first, then spans with text populate asynchronously\\n- We MUST do full text extraction to detect when content is truly ready\\n- Line count or other proxies DON'T WORK\\n\\n## SAFE TO OPTIMIZE (extractCodeFromEditor hot path)\\n\\nThese are pure code optimizations that don't affect timing:\\n\\n| Issue | Impact | Description |\\n|-------|--------|-------------|\\n| fabric-format-su3 + fabric-format-mme | HIGH | Pre-compute parseFloat, check if already sorted |\\n| fabric-format-ocr | HIGH | Single replace at end instead of per-span |\\n| fabric-format-0vn | MEDIUM | Use children iteration instead of querySelectorAll |\\n| fabric-format-h6v | LOW | Use result.changed instead of string === |\\n\\n## INTENTIONAL DESIGN - DO NOT CHANGE\\n\\n| Issue | Status | Why |\\n|-------|--------|-----|\\n| fabric-format-tf3 | Downgraded P3 | Delays are safety margins for virtualization |\\n| fabric-format-8hk | Downgraded P3 | Re-query is defensive against stale elements |\\n| fabric-format-zp6 | Downgraded P3 | Full string compare required, length check insufficient |\\n| fabric-format-gqo | CLOSED | Second scroll is intentional (view may shift during wait) |\\n| fabric-format-tim | CLOSED | Can't parallelize due to virtualization |\\n\\n## BACKLOG\\n\\n| Issue | Status | Why |\\n|-------|--------|-----|\\n| fabric-format-no1 | P4 | Clipboard API change is risky with uncertain benefit |\\n| fabric-format-6m3 | P3 | getComputedStyle is infrequent per cell |\\n| fabric-format-jwv | P3 | Event allocation is negligible |\\n| fabric-format-nqf | P3 | Cell detection runs once per cell |\\n| fabric-format-au2 | P3 | Scroll container runs once per format-all |\\n\\n## RECOMMENDED APPROACH\\n\\n1. **First**: Optimize extractCodeFromEditor (fabric-format-su3, ocr, 0vn)\\n2. **Measure**: Add timing logs to see actual breakdown\\n3. **Then**: Consider if stability loop needs adjustment (likely not)\\n\\nEstimated improvement: 20-30% (revised down from 40-60% since most time is intentional waiting).","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-03T18:33:48.6220576-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T19:42:20.8984769-08:00"}
{"id":"fabric-format-p06","title":"Create Monaco lazy-loading simulator for testing","description":"Currently, testing the text stability checking logic is nearly impossible without a real Fabric notebook in a browser. This makes it:\\n- Hard for AI agents to debug and optimize\\n- Risky to change timing parameters\\n- Impossible to regression test\\n\\n**Proposed solution:**\\nCreate a test harness that simulates Monaco's lazy-loading behavior:\\n\\n1. **MockMonacoEditor class** - Simulates the DOM structure\\n   - Creates .view-line divs immediately\\n   - Populates span text content asynchronously (configurable delays)\\n   - Supports virtualization (elements disappear when 'scrolled' away)\\n\\n2. **Test scenarios:**\\n   - Fast cell (text appears immediately)\\n   - Slow cell (text arrives over 500ms)\\n   - Very large cell (100+ lines, staggered loading)\\n   - Virtualization (editor disconnects/reconnects)\\n\\n3. **Integration:**\\n   - Use in content.test.js\\n   - Allow timing parameter experimentation\\n   - Measure extractCodeFromEditor performance\\n\\n**Benefits:**\\n- Safe optimization of stability loop\\n- Confidence in timing parameter changes\\n- AI agents can actually test their changes\\n\\nThis would go in packages/chromium/src/test-utils/ or similar.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-03T19:01:26.2389406-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T19:31:40.9282087-08:00","closed_at":"2026-01-03T19:31:40.9282087-08:00","close_reason":"Implemented two-phase lazy loading simulator with anti-tests","dependencies":[{"issue_id":"fabric-format-p06","depends_on_id":"fabric-format-ot3","type":"discovered-from","created_at":"2026-01-03T19:01:30.8115692-08:00","created_by":"unknown"}]}
{"id":"fabric-format-p5y","title":"Refactor formatter.ts: Extract function expansion (~100 lines)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T17:36:24.6685897-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-02T17:40:37.3413104-08:00","closed_at":"2026-01-02T17:40:37.3413104-08:00","close_reason":"Created function-expansion.ts with handleFunctionExpansion (~90 lines)","dependencies":[{"issue_id":"fabric-format-p5y","depends_on_id":"fabric-format-3rm","type":"blocks","created_at":"2026-01-02T17:36:42.0988179-08:00","created_by":"unknown"}]}
{"id":"fabric-format-p88","title":"estimateNextInListItemLength walks tokens repeatedly","description":"estimateNextInListItemLength() is called for every comma in an IN list and walks tokens forward to estimate the next item's length:\n\nwhile (idx \u003e= 0 \u0026\u0026 idx \u003c tokenList.length) {\n  const token = tokenList[idx];\n  ...\n  idx = findNextNonWsTokenIndex(idx + 1);\n}\n\nFor large IN lists (100+ values), this becomes expensive.\n\nCould precompute item lengths during analysis phase, or use character positions from the original tokens.\n\nLocation: formatter.ts lines 1163-1210\n\nImpact: O(k) per comma in IN list = O(k^2) for list with k items.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T15:33:14.0718046-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T16:16:49.4300425-08:00","closed_at":"2026-01-03T16:16:49.4300425-08:00","close_reason":"Precomputed IN list item lengths during analysis phase. O(1) lookup instead of O(k) walk per comma. Complexity reduced from O(k^2) to O(k) for large IN lists. All 585 tests pass."}
{"id":"fabric-format-pn6","title":"Review test suite for performance improvements","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-02T19:45:19.1000328-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-02T20:11:14.1443221-08:00","closed_at":"2026-01-02T20:11:14.1443221-08:00","close_reason":"Test suite optimized: CLI tests reduced from 45.6s to ~23s by converting 18+ tests from subprocess spawning to direct function calls. Total test time reduced from 54s to ~32s (40% improvement). Key changes: consolidated directory traversal tests, converted inline formatting tests to use formatCell directly, consolidated exclusion tests into single subprocess call."}
{"id":"fabric-format-pzt","title":"Excessive text extraction in stability check loop","description":"In formatAllCells(), the loop calls extractCodeFromEditor() up to 100 times per cell in the stability check loop (lines 958-1000). Each call does DOM traversal, sorting, and string concatenation.\\n\\n**WHY THIS EXISTS (DO NOT REMOVE):**\\nThis stability checking was added to fix fabric-format-ska - Monaco lazy-loads text content. Even after scroll+focus, the .view-line divs exist but their span children with actual text are populated asynchronously. We MUST do full text extraction to detect when content is truly ready - line count or other proxies don't work because empty divs appear first.\\n\\n**SAFE OPTIMIZATIONS:**\\n1. Make extractCodeFromEditor faster (see related issues)\\n2. Early exit: if text is already stable on first check, skip the loop\\n3. Adaptive polling: start fast (30ms), slow down after first stable check\\n4. Cache extraction result between consecutive identical calls\\n\\n**POTENTIALLY SAFE (needs testing with fabric-format-p06):**\\n- Reduce stableChecks from 3 to 2 (may be sufficient)\\n- Increase polling interval after first stable reading\\n- Use length + sample comparison before full string compare\\n\\n**UNSAFE - DO NOT DO without simulator testing:**\\n- Removing or shortening the stability loop\\n- Using line count instead of full text comparison\\n- Reducing required stable checks below 2\\n\\n**Note:** We stopped when we found A solution, not THE optimal solution. Further optimization is possible but requires the simulator (fabric-format-p06) to safely test changes.\\n\\nLocation: content.js lines 958-1000","status":"in_progress","priority":1,"issue_type":"task","created_at":"2026-01-03T18:32:25.0017831-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T19:42:32.0273922-08:00","dependencies":[{"issue_id":"fabric-format-pzt","depends_on_id":"fabric-format-ot3","type":"discovered-from","created_at":"2026-01-03T18:33:55.8720325-08:00","created_by":"unknown"}]}
{"id":"fabric-format-q1e","title":"Refactor formatter.ts: Extract clause tracking (~50 lines)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T17:36:25.5907276-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-02T17:40:42.0941108-08:00","closed_at":"2026-01-02T17:40:42.0941108-08:00","close_reason":"updateClauseFlags included in output-helpers.ts (~30 lines)","dependencies":[{"issue_id":"fabric-format-q1e","depends_on_id":"fabric-format-3rm","type":"blocks","created_at":"2026-01-02T17:36:42.6106565-08:00","created_by":"unknown"}]}
{"id":"fabric-format-q97","title":"Notebook formatter has O(n*m) complexity due to repeated string splitting","description":"The formatNotebook function is 11x slower than expected due to inefficient string handling.\n\n**Benchmark:**\n- Expected time (isolated cell formatting): 727ms\n- Actual time: 8611ms  \n- Overhead: 7884ms (11x overhead)\n\n**Root Causes:**\n\n1. **replaceCell splits file content on every call** (line 623):\n   \\\\\\\typescript\n   const lines = fileContent.split(/\\\\r?\\\\n/);\n   \\\\\\\n   This is called for EVERY cell that changes. For a file with 10 cells that all change, this splits the entire file 10 times.\n\n2. **parseNotebook also splits** (line 463):\n   \\\\\\\typescript\n   const lines = content.split(/\\\\r?\\\\n/);\n   \\\\\\\n   But this is only once per file, so it's less impactful.\n\n3. **replaceCell returns a new joined string** each time:\n   \\\\\\\typescript\n   return [...before, ...newLines, ...after].join(LINE_ENDING);\n   \\\\\\\n   Then formatNotebook passes this result to the next replaceCell call, which re-splits it.\n\n**Solution:**\nWork with line arrays throughout formatNotebook instead of joining/splitting repeatedly:\n1. Parse once into lines array\n2. Track modifications as line ranges\n3. Build final output in one pass at the end\n\nLocation: notebook-formatter.ts lines 609-656, 700-770\n\nImpact: HIGH - This is the primary bottleneck. 275 files currently take ~9 seconds when they should take ~1 second.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-03T16:32:47.0021272-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T16:43:37.7741737-08:00","closed_at":"2026-01-03T16:43:37.7741737-08:00","close_reason":"Implemented batch processing: O(n*m) -\u003e O(n+m). Warm runs now ~84% faster (8.6s -\u003e 1.3s for 275 notebooks, 2618 cells)"}
{"id":"fabric-format-r1p","title":"Registry pattern may be over-engineered for 2 formatters","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-02T18:19:13.538393371Z","created_by":"runner","updated_at":"2026-01-02T21:43:49.4153014-08:00","closed_at":"2026-01-02T21:43:49.4153014-08:00","close_reason":"By design - registry pattern enables future language support and follows clean architecture"}
{"id":"fabric-format-r3t","title":"Build fails when ANTLR download is blocked by network","description":"Build fails when ANTLR download is blocked by network restrictions (firewalls, offline environments). The build script downloads ANTLR from antlr.org which may be blocked. Solutions: 1) Check for cached ANTLR jar first, 2) Allow specifying ANTLR_JAR_PATH env variable, 3) Bundle ANTLR jar in repo (trade-off: repo size), 4) Document manual download steps.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-02T18:18:55.950440067Z","created_by":"runner","updated_at":"2026-01-02T15:32:50.7548765-08:00","closed_at":"2026-01-02T15:32:50.7548765-08:00","close_reason":"Resolved by updating GitHub Actions workflow config to allow antlr.org downloads","dependencies":[{"issue_id":"fabric-format-r3t","depends_on_id":"fabric-format-44r","type":"related","created_at":"2026-01-02T18:19:36.485547621Z","created_by":"runner"}]}
{"id":"fabric-format-ruu","title":"No tests for concurrent formatting scenarios","description":"No tests for concurrent formatting scenarios. If formatNotebook is called simultaneously on the same file or multiple files, does it work correctly? Add tests for: concurrent formatNotebook calls, concurrent Python formatter initialization, thread safety of global state.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-02T18:18:55.822138794Z","created_by":"runner","updated_at":"2026-01-02T19:43:06.7474269-08:00","closed_at":"2026-01-02T19:43:06.7474269-08:00","close_reason":"Added 5 concurrent formatting tests: concurrent formatNotebook calls, parallel formatCell calls, concurrent Python init (promise sharing), formatCellAsync during init, mixed SQL/Python concurrent formatting"}
{"id":"fabric-format-ska","title":"Fabric lazy loading causes partial cell text capture","description":"Fabric does lazy loading of DOM cells and only loads when you scroll into them. However, the lines don't appear immediately - they're also loaded. The issue is if you scroll too fast, or you grab the text as soon as it's in scope, the text will be partial. We added a wait period and a text char diff but it's still not working reliably. Need to add detailed logging to debug this.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-02T22:36:51.3108258-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-02T23:00:33.1464479-08:00","closed_at":"2026-01-02T23:00:33.1464479-08:00","close_reason":"Fixed by focusing editor before text extraction - Monaco lazy-loads content only when focused"}
{"id":"fabric-format-su3","title":"extractCodeFromEditor sorts lines on every call","description":"extractCodeFromEditor() (lines 604-608) sorts view-lines by style.top on every call:\\n\\nconst sortedLines = Array.from(lines).sort((a, b) =\u003e {\\n  const topA = parseFloat(a.style.top) || 0;\\n  const topB = parseFloat(b.style.top) || 0;\\n  return topA - topB;\\n});\\n\\n**THIS IS A VALID OPTIMIZATION TARGET.**\\nThe sort is needed because Monaco doesn't guarantee DOM order = visual order. However, we can optimize:\\n\\n1. **Check if already sorted** - In most cases, lines ARE in order. Check first/last elements, if in order, skip sort.\\n2. **Pre-compute top values** - Store parseFloat results in a Map before sorting to avoid O(n log n) parseFloat calls.\\n3. **Use integer parsing** - parseInt is faster than parseFloat if Monaco uses integer px values.\\n\\nThis runs in the hot path (up to 100x per cell during stability checking), so optimization here has real impact.\\n\\nLocation: content.js lines 604-608","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T18:32:32.6701753-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T19:39:24.9309523-08:00","closed_at":"2026-01-03T19:39:24.9309523-08:00","close_reason":"Optimized: pre-compute top values, check if already sorted - 51.8% avg speedup","dependencies":[{"issue_id":"fabric-format-su3","depends_on_id":"fabric-format-pzt","type":"related","created_at":"2026-01-03T18:33:21.0069736-08:00","created_by":"unknown"},{"issue_id":"fabric-format-su3","depends_on_id":"fabric-format-ot3","type":"discovered-from","created_at":"2026-01-03T18:33:57.3257938-08:00","created_by":"unknown"}]}
{"id":"fabric-format-tf3","title":"Multiple small setTimeout delays add up","description":"In formatAllCells() and setCodeViaPaste(), there are multiple sequential await setTimeout() calls:\\n- SCROLL_SETTLE_MS (100ms) after scrollIntoView\\n- DOM_SETTLE_MS (50ms) after focus\\n- DOM_SETTLE_MS (50ms) after Ctrl+A\\n- DOM_SETTLE_MS (50ms) after paste\\n- Final DOM_SETTLE_MS (50ms) after each cell\\n\\n**WHY THESE EXIST (CAUTION):**\\nThese delays exist because Monaco and Fabric's React UI need time to process DOM changes. The scroll delay is critical for virtualization - content isn't rendered until scroll completes. The focus delay triggers Monaco's lazy loading (see fabric-format-ska).\\n\\n**SAFE OPTIMIZATIONS:**\\n1. Use requestAnimationFrame + setTimeout combo for DOM waits\\n2. Reduce delays where we can verify completion (e.g., focus already set)\\n3. The final DOM_SETTLE_MS after paste might be removable\\n\\n**RISKY - TEST CAREFULLY:**\\n- Reducing SCROLL_SETTLE_MS below 100ms\\n- Removing focus delay (required for lazy loading)\\n- Any changes must be tested on large notebooks with tall cells\\n\\n**DOWNGRADING to P3** - these delays are intentional safety margins, not bugs.\\n\\nLocation: content.js setCodeViaPaste and formatAllCells","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-03T18:32:49.1593521-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T18:44:39.4346786-08:00","dependencies":[{"issue_id":"fabric-format-tf3","depends_on_id":"fabric-format-ot3","type":"discovered-from","created_at":"2026-01-03T18:33:56.3769883-08:00","created_by":"unknown"}]}
{"id":"fabric-format-tim","title":"Consider parallel formatting before paste","description":"Current flow is sequential per cell:\\n1. Scroll to cell\\n2. Wait for content\\n3. Extract code\\n4. Format (sync CPU work)\\n5. Paste result\\n6. Next cell\\n\\nThe formatCell() call is synchronous and CPU-bound. While we can't parallelize the DOM operations, we could potentially:\\n\\n1. Pre-extract text from visible cells before scrolling to others\\n2. Format in a batch while waiting for DOM to settle\\n3. Use Web Worker for formatting (requires changes to fabric-format)\\n\\nFor notebooks with many already-formatted cells, most time is in DOM waiting. But for notebooks needing lots of formatting, CPU time adds up.\\n\\nThis is an architectural consideration for future optimization.\\n\\nLocation: content.js formatAllCells function","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T18:40:12.0940038-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T18:46:15.396694-08:00","closed_at":"2026-01-03T18:46:15.396694-08:00","close_reason":"Not feasible - Monaco requires sequential scroll+focus+wait per cell due to virtualization. We cannot extract text from cells that aren't scrolled into view. The formatCell() CPU work is minimal compared to DOM waiting time.","dependencies":[{"issue_id":"fabric-format-tim","depends_on_id":"fabric-format-ot3","type":"discovered-from","created_at":"2026-01-03T18:40:23.7525566-08:00","created_by":"unknown"}]}
{"id":"fabric-format-txv","title":"Public API exports internal types like AnalyzerResult unnecessarily","description":"The index.ts exports internal types like AnalyzerResult, FormattingState, MultiArgFunctionInfo, which are implementation details. These expose internal architecture to consumers and create coupling. Move internal types to a separate internal.ts file and only export public-facing types.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:18:56.045114104Z","created_by":"runner","updated_at":"2026-01-02T21:34:46.9787901-08:00","closed_at":"2026-01-02T21:34:46.9787901-08:00","close_reason":"Removed internal types from public API exports: AnalyzerResult, FormattingState, MultiArgFunctionInfo, ExpandedFunction, ExpandedWindow, PendingComment, TokenContext, WindowDefInfo. These are implementation details not needed by library consumers.","dependencies":[{"issue_id":"fabric-format-txv","depends_on_id":"fabric-format-cpr","type":"related","created_at":"2026-01-02T18:19:36.400943254Z","created_by":"runner"}]}
{"id":"fabric-format-ue2","title":"Remove duplicate focusin/mousedown event listeners","description":"Both listeners track lastActiveEditor but mousedown triggers focusin anyway. focusin alone is sufficient.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-03T18:20:25.8407452-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T18:28:00.5272943-08:00","deleted_at":"2026-01-03T18:28:00.5272943-08:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"fabric-format-ur0","title":"No tests for formatCell error handling paths","description":"No tests for formatCell error handling paths. The function returns {error: string} but there are no tests verifying error scenarios. Add tests for: invalid SQL syntax, Python syntax errors, formatter initialization failures, empty input, null input, extremely large input.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:19:13.388409638Z","created_by":"runner","updated_at":"2026-01-02T19:21:32.8963616-08:00","closed_at":"2026-01-02T19:21:32.8963616-08:00","close_reason":"Added formatCell error tests in error-paths.test.ts: invalid SQL, Python syntax errors, nested SQL, unknown types, content preservation","dependencies":[{"issue_id":"fabric-format-ur0","depends_on_id":"fabric-format-1ys","type":"related","created_at":"2026-01-02T18:19:36.3492235Z","created_by":"runner"},{"issue_id":"fabric-format-ur0","depends_on_id":"fabric-format-5fx","type":"blocks","created_at":"2026-01-02T19:13:23.5689678-08:00","created_by":"unknown"}]}
{"id":"fabric-format-ux1","title":"Migrate notebook-parsing.test.ts to node:test","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T19:51:33.0536989-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-02T19:54:10.1781591-08:00","closed_at":"2026-01-02T19:54:10.1781591-08:00","close_reason":"Migration too risky - closing"}
{"id":"fabric-format-v79","title":"Migrate error-context.test.ts to node:test","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T19:51:31.5289558-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-02T19:54:08.9981905-08:00","closed_at":"2026-01-02T19:54:08.9981905-08:00","close_reason":"Migration too risky - closing"}
{"id":"fabric-format-vfh","title":"Missing error path tests for formatNotebook invalid input","description":"Missing tests for error paths in formatNotebook(). The function throws NotebookStructureError but there are no tests verifying this behavior. Add tests for: invalid JSON, missing language metadata, malformed cell structure, empty files, mixed language cells.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:18:55.80381429Z","created_by":"runner","updated_at":"2026-01-02T19:21:31.9310517-08:00","closed_at":"2026-01-02T19:21:31.9310517-08:00","close_reason":"Added tests in error-paths.test.ts: empty file, whitespace-only, non-Fabric, unsupported extension, malformed markers, missing metadata, malformed JSON, NotebookStructureError","dependencies":[{"issue_id":"fabric-format-vfh","depends_on_id":"fabric-format-5fx","type":"blocks","created_at":"2026-01-02T19:13:21.5558755-08:00","created_by":"unknown"}]}
{"id":"fabric-format-vwj","title":"Magic command detection logic duplicated across modules","description":"Magic command detection logic (e.g., '%%sql' detection) is duplicated in formatters/index.ts (detectLanguage) and notebook-formatter.ts. Create a shared utility module magic-commands.ts with functions: detectMagicCommand(code), extractMagicCommand(line), etc. Use this across the codebase.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T18:19:13.313942007Z","created_by":"runner","updated_at":"2026-01-02T17:32:16.2261705-08:00","closed_at":"2026-01-02T17:32:16.2261705-08:00","close_reason":"Intentional - the two modules handle different magic command contexts: formatters/index.ts handles raw %%sql, notebook-formatter.ts handles Fabric-specific # MAGIC %%sql prefixes. Extracting would create over-abstraction.","dependencies":[{"issue_id":"fabric-format-vwj","depends_on_id":"fabric-format-ymx","type":"blocks","created_at":"2026-01-02T17:30:56.1933464-08:00","created_by":"unknown"},{"issue_id":"fabric-format-vwj","depends_on_id":"fabric-format-xgb","type":"related","created_at":"2026-01-02T18:19:36.503082115Z","created_by":"runner"}]}
{"id":"fabric-format-vzp","title":"Redundant Set copies in token loop","description":"In formatTokens() main loop, new Set() copies are created for commaIndices when activating IN list and pivot tracking:\n\n- Line 854: commaIndices: new Set(inListInfo.commaIndices)\n- Line 949: aggregateCommaIndices: new Set(pivotInfoLookup.aggregateCommaIndices)\n- Line 952: inListCommaIndices: new Set(pivotInfoLookup.inListCommaIndices)\n\nThese copies are created because the source arrays need to become Sets for .has() lookup. Consider storing as Sets in the analyzer instead of converting at runtime.\n\nLocation: formatter.ts lines 854, 949, 952\n\nImpact: Array-\u003eSet conversion cost for every IN list and PIVOT.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T15:32:28.8342482-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T15:47:23.9564295-08:00","closed_at":"2026-01-03T15:47:23.9564295-08:00","close_reason":"Changed InListInfo.commaIndices and PivotInfo comma indices from arrays to Sets in types and analyzer"}
{"id":"fabric-format-wg2","title":"Chromium DOM/Performance bug fixes","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T17:25:04.0045862-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-02T17:27:44.1520723-08:00","closed_at":"2026-01-02T17:27:44.1520723-08:00","close_reason":"All 5 Chromium DOM/Performance issues addressed"}
{"id":"fabric-format-x8w","title":"README.md documents 'fabfmt format' but doesn't mention exit codes","description":"README.md documents the 'fabfmt check' command but doesn't mention that it exits with code 1 when changes are needed and 0 when files are already formatted. This is important for CI/CD integration. Add a section explaining exit codes: 0 (success/no changes), 1 (changes needed), 2 (error).","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-02T18:18:55.878783167Z","created_by":"runner","updated_at":"2026-01-02T21:28:32.9517702-08:00","closed_at":"2026-01-02T21:28:32.9517702-08:00","close_reason":"Added exit codes table to README CLI section","dependencies":[{"issue_id":"fabric-format-x8w","depends_on_id":"fabric-format-x9d","type":"related","created_at":"2026-01-02T18:19:36.434250612Z","created_by":"runner"}]}
{"id":"fabric-format-x9d","title":"CONTRIBUTING.md doesn't document how to test chromium package","description":"CONTRIBUTING.md doesn't document how to test the chromium package. Add a section explaining: how to build the extension (npm run build:chromium), how to load it in Chrome/Edge for testing, how to test changes, and what to test before submitting changes.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-02T18:18:55.914200665Z","created_by":"runner","updated_at":"2026-01-02T21:28:33.234813-08:00","closed_at":"2026-01-02T21:28:33.234813-08:00","close_reason":"Added chromium testing section to CONTRIBUTING with npm commands and manual testing instructions"}
{"id":"fabric-format-xgb","title":"Naming inconsistency: formatSql vs formatCell vs formatNotebook","description":"Inconsistent naming: formatSql (for SQL), formatCell (for any cell), formatNotebook (for files). This creates confusion about what each function does. Consider renaming for consistency: formatSqlCode, formatCellCode, formatNotebookFile. Or use a single format() function with type detection.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-02T18:19:13.351599159Z","created_by":"runner","updated_at":"2026-01-02T21:40:11.5567049-08:00","closed_at":"2026-01-02T21:40:11.5567049-08:00","close_reason":"By design - names reflect abstraction levels: formatSql (code), formatCell (cell), formatNotebook (file). Current naming is logical and consistent."}
{"id":"fabric-format-xmm","title":"Chromium extension not loading when notebook opens","description":"Root cause: manifest.json had all_frames: false which prevented the content script from loading in the iframe where the notebook UI lives. The content script's init() function was designed to skip the top frame and only run in iframes, but Chrome never injected it into iframes. Fix: Changed all_frames to true for both content script entries.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-02T22:17:41.0166975-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-02T22:31:40.4818682-08:00","closed_at":"2026-01-02T22:31:40.4818682-08:00","close_reason":"Fixed: URL patterns in manifest.json were changed from wildcards to specific URLs that didn't match all subdomains. Reverted to match main branch patterns."}
{"id":"fabric-format-xo0","title":"Project configuration and cleanup fixes","description":"Quick fixes: .editorconfig, pre-commit hooks, package.json fields, stale TODOs, debug code removal","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T17:13:12.969252-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-02T17:15:51.6530868-08:00","closed_at":"2026-01-02T17:15:51.6530868-08:00","close_reason":"Completed: .editorconfig, pre-commit hooks, author field, TODO removal, debug code removal"}
{"id":"fabric-format-xui","title":"Test framework lacks proper assertion library","description":"Test framework lacks proper assertion library. Tests use simple comparison (===) instead of a proper assertion library with helpful error messages. Consider: 1) Keep custom framework but add assertion helpers (expect, toBe, toThrow), 2) Migrate to Vitest/Jest for better assertions, matcher functions, and error reporting.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-02T18:19:13.445731015Z","created_by":"runner","updated_at":"2026-01-02T21:43:49.7179986-08:00","closed_at":"2026-01-02T21:43:49.7179986-08:00","close_reason":"Won't fix - custom test framework is lightweight and sufficient for current needs"}
{"id":"fabric-format-xzv","title":"Investigate ANTLR parser/lexer instance caching","description":"ANTLR ATN (Augmented Transition Network) initialization may have one-time overhead. Investigate: 1) Can we cache SqlBaseLexer/SqlBaseParser instances between format calls? 2) Does ANTLR4 JS runtime support parser reuse? 3) Measure cold vs warm parsing times to understand initialization cost.","notes":"Implemented parser instance pooling. Pool of 4 reusable lexer/parser instances. Benchmark showed ~6.6x speedup for pure parsing in isolation. Combined with SLL mode, overall performance: ~1.4 ms/KB for formatting. Pool avoids expensive ANTLR instance construction on each format call.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T15:07:19.304165-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T15:18:56.2365288-08:00","closed_at":"2026-01-03T15:18:56.2365288-08:00","close_reason":"Implemented parser instance pooling. Combined with SLL mode: 1.4 ms/KB performance. All 529 tests passing."}
{"id":"fabric-format-yki","title":"Create SQL formatter benchmark suite","description":"Build a benchmark suite with representative SQL workloads:\n- Small queries (1-5 lines): SELECT, INSERT\n- Medium queries (10-50 lines): JOINs, subqueries, CTEs\n- Large queries (100+ lines): Complex analytics\n- Notebooks with many SQL cells\nThis will enable measuring optimization impact.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T14:50:45.717324-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T14:55:46.2291877-08:00","closed_at":"2026-01-03T14:55:46.2291877-08:00","close_reason":"Created benchmark suite with small/medium/large SQL fixtures and runner script. Results show ~6.5ms/KB average, with complex queries (5KB) taking ~30-50ms."}
{"id":"fabric-format-ymx","title":"Code organization and file size refactoring","description":"Refactor large files to comply with 200-400 line guideline and improve module separation","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T17:30:49.278065-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T15:21:45.6004315-08:00","closed_at":"2026-01-03T15:21:45.6004315-08:00","close_reason":"All 10 subtasks completed. Code organization refactoring done."}
{"id":"fabric-format-zhx","title":"Refactor formatter.ts: Extract output helpers (~100 lines)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T17:36:23.834859-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-02T17:40:31.6576966-08:00","closed_at":"2026-01-02T17:40:31.6576966-08:00","close_reason":"Created output-helpers.ts with outputWithNewline, outputWithoutNewline, updateClauseFlags (~160 lines)","dependencies":[{"issue_id":"fabric-format-zhx","depends_on_id":"fabric-format-3rm","type":"blocks","created_at":"2026-01-02T17:36:41.5738333-08:00","created_by":"unknown"}]}
{"id":"fabric-format-zp6","title":"String comparison in stability loop is inefficient","description":"In the text stability check loop (line 975), we compare currentText === lastExtractedText every iteration. For large cells, string comparison is O(n).\\n\\n**CONTEXT:**\\nThis comparison is REQUIRED - we can't use proxies like length because Monaco populates spans incrementally. A cell might have 100 chars, then 150, then 200 as spans load. Length alone won't tell us content is complete.\\n\\n**SAFE OPTIMIZATIONS:**\\n1. Compare length FIRST as a fast negative check - if lengths differ, strings differ (O(1))\\n2. Only do full comparison when lengths match\\n3. This is a micro-optimization but safe to implement\\n\\nPattern:\\nif (currentText.length !== lastExtractedText.length || currentText !== lastExtractedText)\\n\\n**DOWNGRADING to P3** - this is a minor optimization since length check is already O(n) in most languages, and the real cost is in extractCodeFromEditor.\\n\\nLocation: content.js line 975","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-03T18:33:15.0894992-08:00","created_by":"Jacob Knightley","updated_at":"2026-01-03T18:45:08.2809308-08:00","dependencies":[{"issue_id":"fabric-format-zp6","depends_on_id":"fabric-format-pzt","type":"related","created_at":"2026-01-03T18:33:24.7072124-08:00","created_by":"unknown"},{"issue_id":"fabric-format-zp6","depends_on_id":"fabric-format-ot3","type":"discovered-from","created_at":"2026-01-03T18:33:57.8040078-08:00","created_by":"unknown"}]}
